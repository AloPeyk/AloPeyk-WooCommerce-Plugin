!function(M){"use strict";var x=x||{wcshm:{}};x.wcshm.public={},x.wcshm.public.vars={common:{info:window.awcshm,activeClass:"active",loadingClass:"loading",disabledClass:"disabled",alopeykPrefix:"awcshm-",paymentMethodInput:'input[name="payment_method"]'},maps:{selector:".map-canvas",mapContainerClass:"map-container",destinationLatInput:"#destination_latitude, #_shipping_address_latitude",destinationLngInput:"#destination_longitude, #_shipping_address_longitude",destinationCityInput:"#destination_city, #_shipping_address_location_city",destinationAddressInput:"#destination_address, #_shipping_address_location",destinationNumberInput:"#destination_number, #_shipping_address_number",destinationUnitInput:"#destination_unit, #_shipping_address_unit",shippingAddress1Input:"#shipping_address_1, #_shipping_address_1",shippingAddress2Input:"#shipping_address_2, #_shipping_address_2",billingAddress1Input:"#billing_address_1, #_billing_address_1",billingAddress2Input:"#billing_address_2, #_billing_address_2",shipToDifferentAddressInput:'input[name="ship_to_different_address"]',editAddressButton:"a.edit_address:eq(1)",destinationLocatorMapId:"destination-locator-map",destinationLocatorMapClass:"map-canvas destination-locator-map",destinationLocatorCtaClass:"destination-locator-cta",mapMarkerIconClass:"map-marker-icon",destinationLocatorInputWrapperId:"destination-locator-input-wrapper",destinationLocatorInputWrapperClass:"destination-locator-input-wrapper",destinationLocatorAutocompleteResultsClass:"destination-locator-autocomplete-results",destinationLocatorAutocompleteResultClass:"destination-locator-autocomplete-result",destinationLocatorHiddenableInput:".hide-parent-row",autocompletePlaceholderDataAttr:"autocomplete-placeholder",autocompleteKeyupTimeout:null,positionKeyupTimeout:null,autoCompleteKeyupDelay:500,positionKeyupDelay:500,defaultZoom:15,maxZoom:17,defaultCenter:{lat:35.744989,lng:51.375284},cedarMapJsLib:"https://api.cedarmaps.com/cedarmaps.js/v1.8.0/cedarmaps.js",cedarMapCssLib:"https://api.cedarmaps.com/cedarmaps.js/v1.8.0/cedarmaps.css",cedarMapTilesSource:"https://alopeyk.api.cedarmaps.com/v1/tiles/cedarmaps.streets.json?access_token={{TOKEN}}"}},x.wcshm.public.fn={addPrefix:function(a){for(var t=[],s=a.split(" "),e=0;e<s.length;e++)t.push(x.wcshm.public.vars.common.alopeykPrefix+s[e]);return t.join(" ")},translate:function(a){var t=x.wcshm.public.vars.common.info.translations[a];return t||a},injectScript:function(a,t){var s,e;M('[src="'+a+'"]').length||((s=document.createElement("script")).type="text/javascript",s.async=!0,s.src=a,s.onload=t||!1,(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(s,e))},injectStylesheet:function(a){var t,s;M('[href="'+a+'"]').length||((t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.href=a,(s=document.getElementsByTagName("link")[0]).parentNode.insertBefore(t,s))},loadCedarMaps:function(){window.alopeykHandleMapsPublic=x.wcshm.public.fn.handleMaps,"function"==typeof alopeykHandleMapsPublic&&(void 0!==window.L?(window.cedarMapIsLoading=!1,x.wcshm.public.fn.handleMaps()):window.cedarMapIsLoading?x.wcshm.public.vars.loadingMapInterval=setInterval(function(){window.L&&(window.cedarMapIsLoading=!1,clearInterval(x.wcshm.public.vars.loadingMapInterval),x.wcshm.public.fn.handleMaps())},500):(window.cedarMapIsLoading=!0,x.wcshm.public.fn.injectScript(x.wcshm.public.vars.maps.cedarMapJsLib,function(){x.wcshm.public.fn.injectScript(x.wcshm.public.vars.common.info.leaflet_gesture_handling.js,alopeykHandleMapsPublic)}),x.wcshm.public.fn.injectStylesheet(x.wcshm.public.vars.maps.cedarMapCssLib),x.wcshm.public.fn.injectStylesheet(x.wcshm.public.vars.common.info.leaflet_gesture_handling.css)))},handleMaps:function(){M(document).trigger("alopeyk:public:map:loaded")},initMaps:function(){M(document).on("alopeyk:public:map:loaded",function(){var a=M(x.wcshm.public.vars.maps.destinationLatInput),t=M(x.wcshm.public.vars.maps.destinationLngInput),s=M(x.wcshm.public.vars.maps.destinationCityInput),e=M(x.wcshm.public.vars.maps.destinationAddressInput),n=M(x.wcshm.public.vars.maps.destinationNumberInput),i=M(x.wcshm.public.vars.maps.destinationUnitInput),c=M(x.wcshm.public.vars.maps.shippingAddress1Input),o=M(x.wcshm.public.vars.maps.shippingAddress2Input),l=M(x.wcshm.public.vars.maps.billingAddress1Input),p=M(x.wcshm.public.vars.maps.billingAddress2Input),r=M(x.wcshm.public.vars.maps.shipToDifferentAddressInput),u=M(x.wcshm.public.vars.maps.editAddressButton);a.length&&t.length&&s.length&&e.length&&x.wcshm.public.fn.initDestinationLocator(a,t,s,e,n,i,c,o,l,p,r,u)}),x.wcshm.public.fn.loadCedarMaps()},setCurrentGeolocation:function(a){var t=x.wcshm.public.vars.common.destinationMap,s=t?t.mapObject:null,e=M(x.wcshm.public.vars.maps.destinationLatInput),n=M(x.wcshm.public.vars.maps.destinationLngInput);navigator.geolocation&&s&&e.length&&n.length&&(a||!e.val().length&&!n.val().length||e.val()==x.wcshm.public.vars.maps.defaultCenter.lat&&destinationngInput.val()==x.wcshm.public.vars.maps.defaultCenter.lng)&&navigator.geolocation.getCurrentPosition(function(a){x.wcshm.public.vars.maps.fetchAddressConnection&&x.wcshm.public.vars.maps.fetchAddressConnection.abort(),s.setView({lat:a.coords.latitude,lng:a.coords.longitude}),x.wcshm.public.vars.maps.defaultCenter.lat=a.coords.latitude,x.wcshm.public.vars.maps.defaultCenter.lng=a.coords.longitude,e.val(a.coords.latitude),n.val(a.coords.longitude).trigger("change")})},initDestinationLocator:function(h,v,b,w,f,g,y,C,_,I,k,a){var t=function(){var a=x.wcshm.public.vars.common.info.alopeyk.wcshm.map.marker,t=M("<div/>").attr({id:x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.destinationLocatorMapId),class:x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.destinationLocatorMapClass)}),c=w.clone().attr({id:w.attr("id")+"_autocomplete",class:w.attr("class"),placeholder:w.data(x.wcshm.public.vars.maps.autocompletePlaceholderDataAttr),name:"",style:"",type:"text",spellcheck:"false",autocapitalize:"off",autocorrect:"off",autocomplete:"off"}).removeClass(x.wcshm.public.vars.common.disabledClass),s=M("<div>").attr({id:x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.destinationLocatorInputWrapperId),class:x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.destinationLocatorInputWrapperClass)}),o=M("<ul/>").attr({id:x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.destinationLocatorAutocompleteResultsClass),class:x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.destinationLocatorAutocompleteResultsClass)}),e=M("<div/>").attr({class:x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.mapContainerClass)}),n=M("<button/>").attr({type:"button",class:x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.destinationLocatorCtaClass)}),i=M("<img/>").attr({src:a,class:x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.mapMarkerIconClass)});s.insertAfter(w).append(c).append(o),t.insertAfter(s),e.insertAfter(t),e.append(t).append(s).append(n).prepend(i),L.cedarmaps.accessToken=x.wcshm.public.vars.common.info.alopeyk.wcshm.map.api_key;var l={zoom:x.wcshm.public.vars.maps.defaultZoom,maxZoom:x.wcshm.public.vars.maps.maxZoom,center:[h.val().length?parseFloat(h.val()):x.wcshm.public.vars.maps.defaultCenter.lat,v.val().length?parseFloat(v.val()):x.wcshm.public.vars.maps.defaultCenter.lng],zoomControl:!1,gestureHandling:!0,gestureHandlingText:{touch:x.wcshm.public.fn.translate("Use two fingers to move the map"),scroll:x.wcshm.public.fn.translate("Use ctrl + scroll to zoom the map"),scrollMac:x.wcshm.public.fn.translate("Use âŒ˜ + scroll to zoom the map")}},p=L.cedarmaps.map(t.get(0),x.wcshm.public.vars.maps.cedarMapTilesSource.replace("{{TOKEN}}",L.cedarmaps.accessToken),l),r=function(a){var t=o.children(),s=a==t.length?0:a<0?t.length-1:a,e=x.wcshm.public.vars.common.activeClass;t.removeClass(e).eq(s).addClass(e)},u=function(){x.wcshm.public.vars.maps.fetchAddressConnection&&x.wcshm.public.vars.maps.fetchAddressConnection.abort(),s.addClass(x.wcshm.public.vars.common.loadingClass),x.wcshm.public.vars.maps.fetchAddressConnection=M.post(x.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:x.wcshm.public.vars.common.info.ajaxOptions.nonce,action:x.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"get_address",authenticate:!0,ask_cedar:!0,lat:p.getCenter().lat,lng:p.getCenter().lng},function(a){if(a){o.empty(),b.val(a.success&&a.data.city?a.data.city:""),c.val(a.data.address);var t=a.success?a.data.address:"";w.val(t).trigger("change"),y.val(t),C.val(""),k.length&&!k.prop("checked")&&(_.length&&_.val(t),I.length&&I.val(""))}}).always(function(){s.removeClass(x.wcshm.public.vars.common.loadingClass)})},m=function(t){x.wcshm.public.vars.updateShipingMethod&&x.wcshm.public.vars.updateShipingMethod.abort(),w.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return!M(this).is(":disabled")}).prop("disabled",!0).data("alopeyk-disable",!0),x.wcshm.public.vars.updateShipingMethod=M.post(x.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:x.wcshm.public.vars.common.info.ajaxOptions.nonce,action:x.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"set_session",authenticate:!0,lat:p.getCenter().lat,lng:p.getCenter().lng,city:b.val(),address:w.val(),number:f.val(),unit:g.val(),payment_method:M(d+":checked").val()},function(a){a&&a.success&&t&&M("body").trigger("update_checkout"),w.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return M(this).data("alopeyk-disable")}).prop("disabled",!1)})},d=x.wcshm.public.vars.common.paymentMethodInput;L.control.zoom({position:"bottomright"}).addTo(p),x.wcshm.public.vars.common.destinationMap={mapObject:p},x.wcshm.public.vars.common.info.woocommerce.checkout&&(M(document).on("change",d+", #"+w.attr("id"),function(){m(!0)}),M.merge(f,g).on("change paste keyup input propertychange",function(){x.wcshm.public.vars.maps.addressDetailKeyupTimeout&&clearTimeout(x.wcshm.public.vars.maps.addressDetailKeyupTimeout),x.wcshm.public.vars.maps.addressDetailKeyupTimeout=setTimeout(function(){m(!1)},x.wcshm.public.vars.maps.autoCompleteKeyupDelay)})),p.on("move",function(){h.val(p.getCenter().lat),v.val(p.getCenter().lng)}),p.on("dragend",function(){u()}),M.merge(h,v).on("change paste keyup input propertychange",function(){x.wcshm.public.vars.maps.latitudeValue==h.val()&&x.wcshm.public.vars.maps.longitudeValue==v.val()||(x.wcshm.public.vars.maps.latitudeValue=h.val(),x.wcshm.public.vars.maps.longitudeValue=v.val(),x.wcshm.public.vars.maps.positionKeyupTimeout&&clearTimeout(x.wcshm.public.vars.maps.positionKeyupTimeout),x.wcshm.public.vars.maps.positionKeyupTimeout=setTimeout(function(){var a={lat:parseFloat(h.val()),lng:parseFloat(v.val())};p.setView(a),u()},x.wcshm.public.vars.maps.positionKeyupDelay))}),k.on("change",function(){var a=M(this).prop("checked"),t=a?"":"none";_.parent().css("display",t),I.parent().css("display",t),a||(_.val(y.val()),I.val(C.val()))}).trigger("change"),c.on({keydown:function(a){var t=o.children("."+x.wcshm.public.vars.common.activeClass),s=t.length?t.index():-1;switch(a.which){case 13:a.preventDefault(),t&&t.trigger("click");break;case 27:c.blur();break;case 38:a.preventDefault(),r(s-1);break;case 40:a.preventDefault(),r(s+1)}},"change paste keyup input propertychange":function(a){x.wcshm.public.vars.maps.autocompleteInputValue!=c.val()&&(o.empty(),x.wcshm.public.vars.maps.autocompleteInputValue=c.val(),x.wcshm.public.vars.maps.autocompleteKeyupTimeout&&clearTimeout(x.wcshm.public.vars.maps.autocompleteKeyupTimeout),x.wcshm.public.vars.maps.autocompleteKeyupTimeout=setTimeout(function(){x.wcshm.public.vars.maps.autocompleteConnection&&x.wcshm.public.vars.maps.autocompleteConnection.abort(),s.addClass(x.wcshm.public.vars.common.loadingClass),x.wcshm.public.vars.maps.autocompleteConnection=M.post(x.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:x.wcshm.public.vars.common.info.ajaxOptions.nonce,action:x.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"suggest_address",authenticate:!0,input:c.val(),lat:p.getCenter().lat,lng:p.getCenter().lng},function(a){if(a&&a.success&&a.data.length){c.focus();for(var t=0;t<a.data.length;t++){var s={lat:parseFloat(a.data[t].lat),lng:parseFloat(a.data[t].lng)},e=a.data[t].address,n=a.data[t].city,i=M("<li>").addClass(x.wcshm.public.fn.addPrefix(x.wcshm.public.vars.maps.destinationLocatorAutocompleteResultClass)).attr("title",e).data({city:n,address:e,location:s}).text(e).on({click:function(){var a=M(this).data("city"),t=M(this).data("address"),s=M(this).data("location");c.blur(),c.val(t),w.val(t),b.val(a),p.setView(s),p.setZoom(x.wcshm.public.vars.maps.defaultZoom),h.val(s.lat),v.val(s.lng),x.wcshm.public.vars.maps.autocompleteInputValue=t,y.val(t),C.val(""),k.length&&!k.prop("checked")&&(_.length&&_.val(t),I.length&&I.val("")),u()},hover:function(){r(M(this).index())}});o.append(i)}}}).always(function(){s.removeClass(x.wcshm.public.vars.common.loadingClass)})},x.wcshm.public.vars.maps.autoCompleteKeyupDelay))}}),n.on("click",function(){x.wcshm.public.fn.setCurrentGeolocation(!0)}),x.wcshm.public.fn.setCurrentGeolocation()};a.length&&a.is(":visible")?a.on("click",function(){t()}):t()},init:function(){}},M(document).on({ready:function(a){x.wcshm.public.fn.init()}}),M(window).on({load:function(a){x.wcshm.public.fn.initMaps()}})}(jQuery);