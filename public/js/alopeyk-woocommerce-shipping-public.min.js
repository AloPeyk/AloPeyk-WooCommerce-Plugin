!function(R){"use strict";var q=q||{wcshm:{}};q.wcshm.public={},q.wcshm.public.vars={common:{info:window.awcshm,activeClass:"active",loadingClass:"loading",disabledClass:"disabled",alopeykPrefix:"awcshm-",paymentMethodInput:'input[name="payment_method"]',responseDataCity:"",selectedCityType:""},maps:{selector:".map-canvas",mapContainerClass:"map-container",destinationLatInput:"#destination_latitude, #_shipping_address_latitude",destinationLngInput:"#destination_longitude, #_shipping_address_longitude",destinationAddressInput:"#destination_address, #_shipping_address_location",destinationNumberInput:"#destination_number, #_shipping_address_number",destinationUnitInput:"#destination_unit, #_shipping_address_unit",shippingAddress1Input:"#shipping_address_1, #_shipping_address_1",shippingAddress2Input:"#shipping_address_2, #_shipping_address_2",billingAddress1Input:"#billing_address_1, #_billing_address_1",billingAddress2Input:"#billing_address_2, #_billing_address_2",billingAddress1Field:"#billing_address_1_field",addressDetailsFields:"#awcshm-address-details",billingCountry:"#billing_country",shippingCountry:"#shipping_country",billingCity:"#billing_city",shippingCity:"#shipping_city",billingState:"#billing_state",shippingState:"#shipping_state",select2Class:".select2-selection",awcshmLoadingField:"awcshm-loading-field",woocommerceCheckoutClass:".woocommerce-checkout",wcAddAlopeyk:"awcshm-map-visible",shipToDifferentAddressInput:'input[name="ship_to_different_address"]',editAddressButton:"a.edit_address:eq(1)",destinationLocatorMapId:"destination-locator-map",destinationLocatorMapClass:"map-canvas destination-locator-map",destinationLocatorCtaClass:"destination-locator-cta",mapMarkerIconClass:"map-marker-icon",destinationLocatorInputWrapperId:"destination-locator-input-wrapper",destinationLocatorInputWrapperClass:"destination-locator-input-wrapper",destinationLocatorAutocompleteResultsClass:"destination-locator-autocomplete-results",destinationLocatorAutocompleteResultClass:"destination-locator-autocomplete-result",destinationLocatorHiddenableInput:".hide-parent-row",autocompletePlaceholderDataAttr:"autocomplete-placeholder",autocompleteKeyupTimeout:null,positionKeyupTimeout:null,autoCompleteKeyupDelay:500,positionKeyupDelay:500,defaultZoom:15,maxZoom:17,defaultCenter:{lat:35.744989,lng:51.375284},parsiMapJsLib:"https://www.parsimap.com/docs/leaflet/v1.5.1/leaflet.js",parsiMapCssLib:"https://www.parsimap.com/docs/leaflet/v1.5.1/leaflet.css"}},q.wcshm.public.fn={addPrefix:function(a){for(var s=[],e=a.split(" "),t=0;t<e.length;t++)s.push(q.wcshm.public.vars.common.alopeykPrefix+e[t]);return s.join(" ")},translate:function(a){var s=q.wcshm.public.vars.common.info.translations[a];return s||a},injectScript:function(a,s){var e,t;R('[src="'+a+'"]').length||((e=document.createElement("script")).type="text/javascript",e.async=!0,e.src=a,e.onload=s||!1,(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,t))},injectStylesheet:function(a){var s,e;R('[href="'+a+'"]').length||((s=document.createElement("link")).type="text/css",s.rel="stylesheet",s.href=a,(e=document.getElementsByTagName("link")[0]).parentNode.insertBefore(s,e))},loadCedarMaps:function(){window.alopeykHandleMapsPublic=q.wcshm.public.fn.handleMaps,"function"==typeof alopeykHandleMapsPublic&&(void 0!==window.L?(window.cedarMapIsLoading=!1,q.wcshm.public.fn.handleMaps()):window.cedarMapIsLoading?q.wcshm.public.vars.loadingMapInterval=setInterval(function(){window.L&&(window.cedarMapIsLoading=!1,clearInterval(q.wcshm.public.vars.loadingMapInterval),q.wcshm.public.fn.handleMaps())},500):(window.cedarMapIsLoading=!0,q.wcshm.public.fn.injectScript(q.wcshm.public.vars.maps.parsiMapJsLib,function(){q.wcshm.public.fn.injectScript(q.wcshm.public.vars.common.info.alopeyk.wcshm.map.leaflet_gesture_handling.js,alopeykHandleMapsPublic)}),q.wcshm.public.fn.injectStylesheet(q.wcshm.public.vars.maps.parsiMapCssLib),q.wcshm.public.fn.injectStylesheet(q.wcshm.public.vars.common.info.alopeyk.wcshm.map.leaflet_gesture_handling.css)))},handleMaps:function(){R(document).trigger("alopeyk:public:map:loaded")},initMaps:function(){R(document).on("alopeyk:public:map:loaded",function(){var a=R(q.wcshm.public.vars.maps.destinationLatInput),s=R(q.wcshm.public.vars.maps.destinationLngInput),e=R(q.wcshm.public.vars.maps.destinationAddressInput),t=R(q.wcshm.public.vars.maps.destinationNumberInput),i=R(q.wcshm.public.vars.maps.destinationUnitInput),n=R(q.wcshm.public.vars.maps.shippingAddress1Input),c=R(q.wcshm.public.vars.maps.shippingAddress2Input),o=R(q.wcshm.public.vars.maps.billingAddress1Input),l=R(q.wcshm.public.vars.maps.billingAddress2Input),p=R(q.wcshm.public.vars.maps.billingAddress1Field),r=R(q.wcshm.public.vars.maps.addressDetailsFields),m=R(q.wcshm.public.vars.maps.shipToDifferentAddressInput),u=R(q.wcshm.public.vars.maps.editAddressButton),d=q.wcshm.public.vars.maps.billingCountry,h=q.wcshm.public.vars.maps.shippingCountry,v=q.wcshm.public.vars.maps.billingCity,b=q.wcshm.public.vars.maps.shippingCity,w=q.wcshm.public.vars.maps.billingState,g=q.wcshm.public.vars.maps.shippingState,f=q.wcshm.public.vars.maps.select2Class,y=q.wcshm.public.vars.maps.awcshmLoadingField,C=q.wcshm.public.vars.maps.woocommerceCheckoutClass,_=q.wcshm.public.vars.maps.wcAddAlopeyk;a.length&&s.length&&e.length&&q.wcshm.public.fn.initDestinationLocator(a,s,e,t,i,n,c,o,l,p,m,u,r,d,h,v,b,w,g,C,_,f,y)}),q.wcshm.public.fn.loadCedarMaps()},setCurrentGeolocation:function(a){var s=q.wcshm.public.vars.common.destinationMap,e=s?s.mapObject:null,t=R(q.wcshm.public.vars.maps.destinationLatInput),i=R(q.wcshm.public.vars.maps.destinationLngInput);navigator.geolocation&&e&&t.length&&i.length&&(a||!t.val().length&&!i.val().length||t.val()==q.wcshm.public.vars.maps.defaultCenter.lat&&destinationngInput.val()==q.wcshm.public.vars.maps.defaultCenter.lng)&&navigator.geolocation.getCurrentPosition(function(a){q.wcshm.public.vars.maps.fetchAddressConnection&&q.wcshm.public.vars.maps.fetchAddressConnection.abort(),e.setView({lat:a.coords.latitude,lng:a.coords.longitude}),q.wcshm.public.vars.maps.defaultCenter.lat=a.coords.latitude,q.wcshm.public.vars.maps.defaultCenter.lng=a.coords.longitude,t.val(a.coords.latitude),i.val(a.coords.longitude).trigger("change")})},initDestinationLocator:function(w,g,f,y,C,_,k,I,x,a,A,s,e,M,T,j,D,P,K,O,S,F,V){var t=function(){var a=q.wcshm.public.vars.common.info.alopeyk.wcshm.map.marker,s=R("<div/>").attr({id:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorMapId),class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorMapClass)}),c=f.clone().attr({id:f.attr("id")+"_autocomplete",class:f.attr("class"),placeholder:f.data(q.wcshm.public.vars.maps.autocompletePlaceholderDataAttr),name:"",style:"",type:"text",spellcheck:"false",autocapitalize:"off",autocorrect:"off",autocomplete:"off"}).removeClass(q.wcshm.public.vars.common.disabledClass),e=R("<div>").attr({id:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorInputWrapperId),class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorInputWrapperClass)}),o=R("<ul/>").attr({id:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorAutocompleteResultsClass),class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorAutocompleteResultsClass)}),t=R("<div/>").attr({class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.mapContainerClass)}),i=R("<button/>").attr({type:"button",class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorCtaClass)}),n=R("<img/>").attr({src:a,class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.mapMarkerIconClass)});e.insertAfter(f).append(c).append(o),s.insertAfter(e),t.insertAfter(s),t.append(s).append(e).append(i).prepend(n);var l={zoom:q.wcshm.public.vars.maps.defaultZoom,maxZoom:q.wcshm.public.vars.maps.maxZoom,center:[w.val().length?parseFloat(w.val()):q.wcshm.public.vars.maps.defaultCenter.lat,g.val().length?parseFloat(g.val()):q.wcshm.public.vars.maps.defaultCenter.lng],zoomControl:!1,gestureHandling:!0,gestureHandlingText:{touch:q.wcshm.public.fn.translate("Use two fingers to move the map"),scroll:q.wcshm.public.fn.translate("Use ctrl + scroll to zoom the map"),scrollMac:q.wcshm.public.fn.translate("Use âŒ˜ + scroll to zoom the map")}},p=L.map(s.get(0),l),r=function(a){var s=o.children(),e=a==s.length?0:a<0?s.length-1:a,t=q.wcshm.public.vars.common.activeClass;s.removeClass(t).eq(e).addClass(t)},m=function(){q.wcshm.public.vars.maps.fetchAddressConnection&&q.wcshm.public.vars.maps.fetchAddressConnection.abort(),e.addClass(q.wcshm.public.vars.common.loadingClass),q.wcshm.public.vars.maps.fetchAddressConnection=R.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"get_address",authenticate:!0,lat:p.getCenter().lat,lng:p.getCenter().lng},function(a){if(a){o.empty(),c.val(a.data.address);var s=j,e=P;A.prop("checked")&&(s=D,e=K);var t=d(s,a.data.city),i=d(e,a.data.province);if(0<t.length?R(s).val(t).triggerHandler("change"):(R(e).val(i).trigger("change"),q.wcshm.public.vars.common.responseDataCity=a.data.city,q.wcshm.public.vars.common.selectedCityType=s),R("."+S).length){var n=a.success?a.data.address:"";f.val(n),_.val(n),k.val(""),A.length&&!A.prop("checked")&&(I.length&&I.val(n),x.length&&x.val(""))}f.trigger("change")}}).always(function(){e.removeClass(q.wcshm.public.vars.common.loadingClass)})},u=function(s){q.wcshm.public.vars.updateShippingMethod&&q.wcshm.public.vars.updateShippingMethod.abort(),f.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return!R(this).is(":disabled")}).prop("disabled",!0).data("alopeyk-disable",!0),q.wcshm.public.vars.updateShippingMethod=R.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"set_session",authenticate:!0,lat:p.getCenter().lat,lng:p.getCenter().lng,address:f.val(),number:y.val(),unit:C.val(),payment_method:R(b+":checked").val()},function(a){a&&a.success&&s&&R("body").trigger("update_checkout"),f.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return R(this).data("alopeyk-disable")}).prop("disabled",!1)})},d=function(a,s){var e=R(a+' option[value="'+s+'"]').val(),t=R(a+" option").filter(function(){return R(this).html()==s}).val();return e&&0<e.length?e:t&&0<t.length?t:""},h=function(i){var n="#"+i+"_city",a="#"+i+"_country";R(n).prop("disabled",!0).parent().find(F).addClass(V),"IR"==R(a).val()?(R(n).empty(),R(n).append(R("<option>",{value:"",text:""})),q.wcshm.public.vars.maps.fetchIRCities=R.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"get_iran_cities",selected_state:R("#"+i+"_state option:selected").text()},function(t){if(t){R(n).prop("disabled",!1).parent().find(F).removeClass(V),R.each(t.data.cities,function(a,s){if("null"!==s){var e=void 0;"billing"==i?s.name==t.data.pre_billing_city&&(e="selected"):"shipping"==i&&s.name==t.data.pre_shipping_city&&(e="selected"),R(n).append(R("<option>",{value:s.name,text:s.name,attr:{cedar_center:s.location.center,selected:e}}))}});var a="";""!=q.wcshm.public.vars.common.selectedCityType&&q.wcshm.public.vars.common.selectedCityType==n&&0<(a=d(n,q.wcshm.public.vars.common.responseDataCity)).length&&R(n).val(a),q.wcshm.public.vars.common.selectedCityType="",R(n).trigger("change")}})):R(n).prop("disabled",!1).parent().find(F).removeClass(V)},v=function(a){var s="#"+a+"_city";if("IR"==R("#"+a+"_country").val()){var e=R(s).find("option:selected");if(0<e.text().length){var t=e.attr("cedar_center");if(t=t.split(","),q.wcshm.public.vars.common.responseDataCity!=e.val()&&t&&0<t.length&&(w.val(t[0]),g.val(t[1]).trigger("change"),R(O).removeClass(S)),"yes"==q.wcshm.public.vars.common.info.alopeyk.wcshm.config.map_always_visible)R(O).addClass(S);else if(R(O).removeClass(S),"no"==q.wcshm.public.vars.common.info.alopeyk.wcshm.config.intercity){var i=e.val();R(O).addClass(S),i!=q.wcshm.public.vars.common.info.alopeyk.wcshm.config.store_city&&R(O).removeClass(S)}else q.wcshm.public.vars.maps.autocompleteConnection=R.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"get_address",scope:"admin",authenticate:!0,lat:t[0],lng:t[1]},function(a){a.success&&a.data.city?R(O).addClass(S):R(O).removeClass(S)})}}else R(O).removeClass(S)},b=q.wcshm.public.vars.common.paymentMethodInput;!function(){if(R(j).parent().find(F).addClass(V),R(D).parent().find(F).addClass(V),h("billing"),h("shipping"),"yes"==q.wcshm.public.vars.common.info.alopeyk.wcshm.config.map_always_visible){var a=M;A.prop("checked")&&(a=T),"IR"==R(a).val()&&(R(O).addClass(S),m())}}(),R(document).on("change",P,function(a){h("billing")}).on("change",K,function(a){h("shipping")}).on("change",j,function(a){A.prop("checked")||v("billing")}).on("change",D,function(a){A.prop("checked")&&v("shipping")}),L.control.zoom({position:"bottomleft"}).addTo(p),L.tileLayer(q.wcshm.public.vars.common.info.alopeyk.wcshm.map.api_url.replace("{{TOKEN}}",q.wcshm.public.vars.common.info.alopeyk.wcshm.map.api_key)).addTo(p),q.wcshm.public.vars.common.destinationMap={mapObject:p},q.wcshm.public.vars.common.info.woocommerce.checkout&&(R(document).on("change",b+", #"+f.attr("id"),function(){u(!0)}),R.merge(y,C).on("change paste keyup input propertychange",function(){q.wcshm.public.vars.maps.addressDetailKeyupTimeout&&clearTimeout(q.wcshm.public.vars.maps.addressDetailKeyupTimeout),q.wcshm.public.vars.maps.addressDetailKeyupTimeout=setTimeout(function(){u(!1)},q.wcshm.public.vars.maps.autoCompleteKeyupDelay)})),p.on("move dragend zoomend",function(){w.val(p.getCenter().lat),g.val(p.getCenter().lng).trigger("change")}),R.merge(w,g).on("change paste keyup input propertychange",function(){q.wcshm.public.vars.maps.latitudeValue==w.val()&&q.wcshm.public.vars.maps.longitudeValue==g.val()||(q.wcshm.public.vars.maps.latitudeValue=w.val(),q.wcshm.public.vars.maps.longitudeValue=g.val(),q.wcshm.public.vars.maps.positionKeyupTimeout&&clearTimeout(q.wcshm.public.vars.maps.positionKeyupTimeout),q.wcshm.public.vars.maps.positionKeyupTimeout=setTimeout(function(){var a={lat:parseFloat(w.val()),lng:parseFloat(g.val())};p.setView(a),m()},q.wcshm.public.vars.maps.positionKeyupDelay))}),A.on("change",function(){var a=R(this).prop("checked");a?v("shipping"):(I.val(_.val()),x.val(k.val()),v("billing"))}).trigger("change"),c.on({keydown:function(a){var s=o.children("."+q.wcshm.public.vars.common.activeClass),e=s.length?s.index():-1;switch(a.which){case 13:a.preventDefault(),s&&s.trigger("click");break;case 27:c.blur();break;case 38:a.preventDefault(),r(e-1);break;case 40:a.preventDefault(),r(e+1)}},"change paste keyup input propertychange":function(a){q.wcshm.public.vars.maps.autocompleteInputValue!=c.val()&&(o.empty(),q.wcshm.public.vars.maps.autocompleteInputValue=c.val(),q.wcshm.public.vars.maps.autocompleteKeyupTimeout&&clearTimeout(q.wcshm.public.vars.maps.autocompleteKeyupTimeout),q.wcshm.public.vars.maps.autocompleteKeyupTimeout=setTimeout(function(){q.wcshm.public.vars.maps.autocompleteConnection&&q.wcshm.public.vars.maps.autocompleteConnection.abort(),e.addClass(q.wcshm.public.vars.common.loadingClass),q.wcshm.public.vars.maps.autocompleteConnection=R.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"suggest_address",authenticate:!0,input:c.val(),lat:p.getCenter().lat,lng:p.getCenter().lng},function(a){if(a&&a.success&&a.data.length){c.focus();for(var s=0;s<a.data.length;s++){var e={lat:parseFloat(a.data[s].lat),lng:parseFloat(a.data[s].lng)},t=a.data[s].address,i=a.data[s].city,n=R("<li>").addClass(q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorAutocompleteResultClass)).attr("title",t).data({city:i,address:t,location:e}).text(t).on({click:function(){R(this).data("city");var a=R(this).data("address"),s=R(this).data("location");c.blur(),c.val(a),f.val(a),p.setView(s),p.setZoom(q.wcshm.public.vars.maps.defaultZoom),w.val(s.lat),g.val(s.lng),q.wcshm.public.vars.maps.autocompleteInputValue=a,_.val(a),k.val(""),A.length&&!A.prop("checked")&&(I.length&&I.val(a),x.length&&x.val("")),m()},hover:function(){r(R(this).index())}});o.append(n)}}}).always(function(){e.removeClass(q.wcshm.public.vars.common.loadingClass)})},q.wcshm.public.vars.maps.autoCompleteKeyupDelay))}}),i.on("click",function(){q.wcshm.public.fn.setCurrentGeolocation(!0)}),q.wcshm.public.fn.setCurrentGeolocation()};s.length&&s.is(":visible")?s.on("click",function(){t()}):t()},init:function(){}},R(document).on({ready:function(a){q.wcshm.public.fn.init()}}),R(window).on({load:function(a){q.wcshm.public.fn.initMaps()}})}(jQuery);