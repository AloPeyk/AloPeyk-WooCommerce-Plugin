!function(a){"use strict";var t=t||{wcshm:{}};t.wcshm.public={},t.wcshm.public.vars={common:{info:window.awcshm,activeClass:"active",loadingClass:"loading",disabledClass:"disabled",alopeykPrefix:"awcshm-",paymentMethodInput:'input[name="payment_method"]'},maps:{selector:".map-canvas",mapContainerClass:"map-container",destinationLatInput:"#destination_latitude, #_shipping_address_latitude",destinationLngInput:"#destination_longitude, #_shipping_address_longitude",destinationCityInput:"#destination_city, #_shipping_address_location_city",destinationAddressInput:"#destination_address, #_shipping_address_location",destinationNumberInput:"#destination_number, #_shipping_address_number",destinationUnitInput:"#destination_unit, #_shipping_address_unit",shippingAddress1Input:"#shipping_address_1, #_shipping_address_1",shippingAddress2Input:"#shipping_address_2, #_shipping_address_2",billingAddress1Input:"#billing_address_1, #_billing_address_1",billingAddress2Input:"#billing_address_2, #_billing_address_2",shipToDifferentAddressInput:'input[name="ship_to_different_address"]',editAddressButton:"a.edit_address:eq(1)",destinationLocatorMapId:"destination-locator-map",destinationLocatorMapClass:"map-canvas destination-locator-map",destinationLocatorInputWrapperId:"destination-locator-input-wrapper",destinationLocatorInputWrapperClass:"destination-locator-input-wrapper",destinationLocatorAutocompleteResultsClass:"destination-locator-autocomplete-results",destinationLocatorAutocompleteResultClass:"destination-locator-autocomplete-result",destinationLocatorHiddenableInput:".hide-parent-row",autocompletePlaceholderDataAttr:"autocomplete-placeholder",autocompleteKeyupTimeout:null,positionKeyupTimeout:null,autoCompleteKeyupDelay:500,positionKeyupDelay:500,defaultZoom:15,defaultCenter:{lat:35.744989,lng:51.375284}}},t.wcshm.public.fn={addPrefix:function(a){for(var s=[],e=a.split(" "),i=0;i<e.length;i++)s.push(t.wcshm.public.vars.common.alopeykPrefix+e[i]);return s.join(" ")},injectScript:function(t){if(!a('[src="'+t+'"]').length){var s,e;(s=document.createElement("script")).type="text/javascript",s.async=!0,s.src=t,(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(s,e)}},loadGoogleMaps:function(){window.alopeykHandleMapsPublic=t.wcshm.public.fn.handleMaps,"function"==typeof alopeykHandleMapsPublic&&(void 0!==window.google&&window.google.maps?(window.googleMapIsLoading=!1,t.wcshm.public.fn.handleMaps()):window.googleMapIsLoading?t.wcshm.public.vars.loadingMapInterval=setInterval(function(){window.google&&window.google.maps&&(window.googleMapIsLoading=!1,clearInterval(t.wcshm.public.vars.loadingMapInterval),t.wcshm.public.fn.handleMaps())},500):(window.googleMapIsLoading=!0,t.wcshm.public.fn.injectScript("https://maps.googleapis.com/maps/api/js?key="+t.wcshm.public.vars.common.info.alopeyk.wcshm.map.api_key+"&libraries=places&language=fa&region=IR&callback=alopeykHandleMapsPublic")))},handleMaps:function(){a(document).trigger("alopeyk:public:map:loaded")},initMaps:function(){t.wcshm.public.fn.loadGoogleMaps(),a(document).on("alopeyk:public:map:loaded",function(){var s=a(t.wcshm.public.vars.maps.destinationLatInput),e=a(t.wcshm.public.vars.maps.destinationLngInput),i=a(t.wcshm.public.vars.maps.destinationCityInput),n=a(t.wcshm.public.vars.maps.destinationAddressInput),o=a(t.wcshm.public.vars.maps.destinationNumberInput),c=a(t.wcshm.public.vars.maps.destinationUnitInput),l=a(t.wcshm.public.vars.maps.shippingAddress1Input),p=a(t.wcshm.public.vars.maps.shippingAddress2Input),r=a(t.wcshm.public.vars.maps.billingAddress1Input),u=a(t.wcshm.public.vars.maps.billingAddress2Input),m=a(t.wcshm.public.vars.maps.shipToDifferentAddressInput),d=a(t.wcshm.public.vars.maps.editAddressButton);s.length&&e.length&&i.length&&n.length&&t.wcshm.public.fn.initDestinationLocator(s,e,i,n,o,c,l,p,r,u,m,d)})},setCurrentGeolocation:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){t.wcshm.public.vars.maps.defaultCenter.lat=a.coords.latitude,t.wcshm.public.vars.maps.defaultCenter.lng=a.coords.longitude})},initDestinationLocator:function(s,e,i,n,o,c,l,p,r,u,m,d){var h=function(){var d=a("<div/>").attr({id:t.wcshm.public.fn.addPrefix(t.wcshm.public.vars.maps.destinationLocatorMapId),class:t.wcshm.public.fn.addPrefix(t.wcshm.public.vars.maps.destinationLocatorMapClass)}),h=n.clone().attr({id:n.attr("id")+"_autocomplete",class:n.attr("class"),placeholder:n.data(t.wcshm.public.vars.maps.autocompletePlaceholderDataAttr),name:"",style:"",type:"text",spellcheck:"false",autocapitalize:"off",autocorrect:"off",autocomplete:"off"}).removeClass(t.wcshm.public.vars.common.disabledClass),v=a("<div>").attr({id:t.wcshm.public.fn.addPrefix(t.wcshm.public.vars.maps.destinationLocatorInputWrapperId),class:t.wcshm.public.fn.addPrefix(t.wcshm.public.vars.maps.destinationLocatorInputWrapperClass)}),g=a("<ul>").attr({id:t.wcshm.public.fn.addPrefix(t.wcshm.public.vars.maps.destinationLocatorAutocompleteResultsClass),class:t.wcshm.public.fn.addPrefix(t.wcshm.public.vars.maps.destinationLocatorAutocompleteResultsClass)}),b=a("<div/>").attr({class:t.wcshm.public.fn.addPrefix(t.wcshm.public.vars.maps.mapContainerClass)});v.insertAfter(n).append(h).append(g),d.insertAfter(v),b.insertAfter(d),b.append(d),b.append(v);var w=t.wcshm.public.vars.common.info.alopeyk.wcshm.map.marker,f=t.wcshm.public.vars.common.info.alopeyk.wcshm.map.styles,y={zoom:t.wcshm.public.vars.maps.defaultZoom,styles:f?a.parseJSON(f):null,center:{lat:s.val().length?parseFloat(s.val()):t.wcshm.public.vars.maps.defaultCenter.lat,lng:e.val().length?parseFloat(e.val()):t.wcshm.public.vars.maps.defaultCenter.lng},mapTypeControl:!1,fullscreenControl:!1,streetViewControl:!1},_=new google.maps.Map(d.get(0),y),C=new google.maps.Marker({map:_,draggable:!0,position:y.center,icon:w||null}),I=function(a){var s=g.children(),e=a==s.length?0:a<0?s.length-1:a,i=t.wcshm.public.vars.common.activeClass;s.removeClass(i).eq(e).addClass(i)},k=function(){t.wcshm.public.vars.maps.fetchAddressConnection&&t.wcshm.public.vars.maps.fetchAddressConnection.abort(),v.addClass(t.wcshm.public.vars.common.loadingClass),t.wcshm.public.vars.maps.fetchAddressConnection=a.post(t.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:t.wcshm.public.vars.common.info.ajaxOptions.nonce,action:t.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"get_address",authenticate:!0,ask_google:!0,lat:C.getPosition().lat(),lng:C.getPosition().lng()},function(a){if(a){g.empty(),i.val(a.success&&a.data.city?a.data.city:""),h.val(a.data.address);var t=a.success?a.data.address:"";n.val(t).trigger("change"),l.val(t),p.val(""),m.length&&!m.prop("checked")&&(r.length&&r.val(t),u.length&&u.val(""))}}).always(function(){v.removeClass(t.wcshm.public.vars.common.loadingClass)})},L=function(s){t.wcshm.public.vars.updateShipingMethod&&t.wcshm.public.vars.updateShipingMethod.abort(),n.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return!a(this).is(":disabled")}).prop("disabled",!0).data("alopeyk-disable",!0),t.wcshm.public.vars.updateShipingMethod=a.post(t.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:t.wcshm.public.vars.common.info.ajaxOptions.nonce,action:t.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"set_session",authenticate:!0,lat:C.getPosition().lat(),lng:C.getPosition().lng(),city:i.val(),address:n.val(),number:o.val(),unit:c.val(),payment_method:a(M+":checked").val()},function(t){t&&t.success&&s&&a("body").trigger("update_checkout"),n.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return a(this).data("alopeyk-disable")}).prop("disabled",!1)})},M=t.wcshm.public.vars.common.paymentMethodInput;t.wcshm.public.vars.common.info.woocommerce.checkout&&(a(document).on("change",M+", #"+n.attr("id"),function(){L(!0)}),a.merge(o,c).on("change paste keyup input propertychange",function(){t.wcshm.public.vars.maps.addressDetailKeyupTimeout&&clearTimeout(t.wcshm.public.vars.maps.addressDetailKeyupTimeout),t.wcshm.public.vars.maps.addressDetailKeyupTimeout=setTimeout(function(){L(!1)},t.wcshm.public.vars.maps.autoCompleteKeyupDelay)})),C.addListener("drag",function(){s.val(C.getPosition().lat()),e.val(C.getPosition().lng())}),C.addListener("dragend",function(){k()}),a.merge(s,e).on("change paste keyup input propertychange",function(){t.wcshm.public.vars.maps.latitudeValue==s.val()&&t.wcshm.public.vars.maps.longitudeValue==e.val()||(t.wcshm.public.vars.maps.latitudeValue=s.val(),t.wcshm.public.vars.maps.longitudeValue=e.val(),t.wcshm.public.vars.maps.positionKeyupTimeout&&clearTimeout(t.wcshm.public.vars.maps.positionKeyupTimeout),t.wcshm.public.vars.maps.positionKeyupTimeout=setTimeout(function(){var a={lat:parseFloat(s.val()),lng:parseFloat(e.val())};_.setCenter(a),C.setPosition(a),k()},t.wcshm.public.vars.maps.positionKeyupDelay))}),m.on("change",function(){var t=a(this).prop("checked"),s=t?"":"none";r.parent().css("display",s),u.parent().css("display",s),t||(r.val(l.val()),u.val(p.val()))}).trigger("change"),h.on({keydown:function(a){var s=g.children("."+t.wcshm.public.vars.common.activeClass),e=s.length?s.index():-1;switch(a.which){case 13:a.preventDefault(),s&&s.trigger("click");break;case 27:h.blur();break;case 38:a.preventDefault(),I(e-1);break;case 40:a.preventDefault(),I(e+1)}},"change paste keyup input propertychange":function(o){t.wcshm.public.vars.maps.autocompleteInputValue!=h.val()&&(g.empty(),t.wcshm.public.vars.maps.autocompleteInputValue=h.val(),t.wcshm.public.vars.maps.autocompleteKeyupTimeout&&clearTimeout(t.wcshm.public.vars.maps.autocompleteKeyupTimeout),t.wcshm.public.vars.maps.autocompleteKeyupTimeout=setTimeout(function(){t.wcshm.public.vars.maps.autocompleteConnection&&t.wcshm.public.vars.maps.autocompleteConnection.abort(),v.addClass(t.wcshm.public.vars.common.loadingClass),t.wcshm.public.vars.maps.autocompleteConnection=a.post(t.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:t.wcshm.public.vars.common.info.ajaxOptions.nonce,action:t.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"suggest_address",authenticate:!0,input:h.val()},function(o){if(o&&o.success&&o.data.length)for(var c=0;c<o.data.length;c++){var d={lat:parseFloat(o.data[c].lat),lng:parseFloat(o.data[c].lng)},v=o.data[c].address,b=o.data[c].city,w=a("<li>").addClass(t.wcshm.public.fn.addPrefix(t.wcshm.public.vars.maps.destinationLocatorAutocompleteResultClass)).attr("title",v).data({city:b,address:v,location:d}).text(v).on({click:function(){var o=a(this).data("city"),c=a(this).data("address"),d=a(this).data("location");h.blur(),h.val(c),n.val(c),i.val(o),_.setCenter(d),_.setZoom(17),C.setPosition(d),C.setVisible(!0),s.val(d.lat),e.val(d.lng),t.wcshm.public.vars.maps.autocompleteInputValue=c,l.val(c),p.val(""),m.length&&!m.prop("checked")&&(r.length&&r.val(c),u.length&&u.val("")),k()},hover:function(){I(a(this).index())}});g.append(w)}}).always(function(){v.removeClass(t.wcshm.public.vars.common.loadingClass)})},t.wcshm.public.vars.maps.autoCompleteKeyupDelay))}}),google.maps.event.addListenerOnce(_,"idle",function(){v.css("position","absolute")}),google.maps.event.addDomListener(window,"resize",function(){t.wcshm.public.vars.maps.centerTimeout&&clearTimeout(t.wcshm.public.vars.maps.centerTimeout),t.wcshm.public.vars.maps.centerTimeout=setTimeout(function(){_.setCenter(C.getPosition())},100)})};d.length&&d.is(":visible")?d.on("click",function(){h()}):h()},init:function(){}},a(document).on({ready:function(a){t.wcshm.public.fn.init()}}),a(window).on({load:function(a){t.wcshm.public.fn.initMaps(),t.wcshm.public.fn.setCurrentGeolocation()}})}(jQuery);