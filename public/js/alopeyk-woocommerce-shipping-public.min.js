!function(S){"use strict";var q=q||{wcshm:{}};q.wcshm.public={},q.wcshm.public.vars={common:{info:window.awcshm,activeClass:"active",loadingClass:"loading",disabledClass:"disabled",alopeykPrefix:"awcshm-",paymentMethodInput:'input[name="payment_method"]',responseDataCity:"",selectedCityType:""},maps:{selector:".map-canvas",mapContainerClass:"map-container",destinationLatInput:"#destination_latitude, #_shipping_address_latitude",destinationLngInput:"#destination_longitude, #_shipping_address_longitude",destinationAddressInput:"#destination_address, #_shipping_address_location",destinationNumberInput:"#destination_number, #_shipping_address_number",destinationUnitInput:"#destination_unit, #_shipping_address_unit",shippingAddress1Input:"#shipping_address_1, #_shipping_address_1",shippingAddress2Input:"#shipping_address_2, #_shipping_address_2",billingAddress1Input:"#billing_address_1, #_billing_address_1",billingAddress2Input:"#billing_address_2, #_billing_address_2",billing_address_1_field:"#billing_address_1_field",addressDetailsFields:"#awcshm-address-details",billing_country:"#billing_country",shipping_country:"#shipping_country",billing_city:"#billing_city",shipping_city:"#shipping_city",billing_state:"#billing_state",shipping_state:"#shipping_state",select2Class:".select2-selection",awcshmLoadingField:"awcshm-loading-field",woocommerce_checkout_class:".woocommerce-checkout",wc_add_alopeyk:"awcshm-map-visible",shipToDifferentAddressInput:'input[name="ship_to_different_address"]',editAddressButton:"a.edit_address:eq(1)",destinationLocatorMapId:"destination-locator-map",destinationLocatorMapClass:"map-canvas destination-locator-map",destinationLocatorCtaClass:"destination-locator-cta",mapMarkerIconClass:"map-marker-icon",destinationLocatorInputWrapperId:"destination-locator-input-wrapper",destinationLocatorInputWrapperClass:"destination-locator-input-wrapper",destinationLocatorAutocompleteResultsClass:"destination-locator-autocomplete-results",destinationLocatorAutocompleteResultClass:"destination-locator-autocomplete-result",destinationLocatorHiddenableInput:".hide-parent-row",autocompletePlaceholderDataAttr:"autocomplete-placeholder",autocompleteKeyupTimeout:null,positionKeyupTimeout:null,autoCompleteKeyupDelay:500,positionKeyupDelay:500,defaultZoom:15,maxZoom:17,defaultCenter:{lat:35.744989,lng:51.375284},cedarMapJsLib:"https://api.cedarmaps.com/cedarmaps.js/v1.8.0/cedarmaps.js",cedarMapCssLib:"https://api.cedarmaps.com/cedarmaps.js/v1.8.0/cedarmaps.css"}},q.wcshm.public.fn={addPrefix:function(a){for(var s=[],e=a.split(" "),t=0;t<e.length;t++)s.push(q.wcshm.public.vars.common.alopeykPrefix+e[t]);return s.join(" ")},translate:function(a){var s=q.wcshm.public.vars.common.info.translations[a];return s||a},injectScript:function(a,s){var e,t;S('[src="'+a+'"]').length||((e=document.createElement("script")).type="text/javascript",e.async=!0,e.src=a,e.onload=s||!1,(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,t))},injectStylesheet:function(a){var s,e;S('[href="'+a+'"]').length||((s=document.createElement("link")).type="text/css",s.rel="stylesheet",s.href=a,(e=document.getElementsByTagName("link")[0]).parentNode.insertBefore(s,e))},loadCedarMaps:function(){window.alopeykHandleMapsPublic=q.wcshm.public.fn.handleMaps,"function"==typeof alopeykHandleMapsPublic&&(void 0!==window.L?(window.cedarMapIsLoading=!1,q.wcshm.public.fn.handleMaps()):window.cedarMapIsLoading?q.wcshm.public.vars.loadingMapInterval=setInterval(function(){window.L&&(window.cedarMapIsLoading=!1,clearInterval(q.wcshm.public.vars.loadingMapInterval),q.wcshm.public.fn.handleMaps())},500):(window.cedarMapIsLoading=!0,q.wcshm.public.fn.injectScript(q.wcshm.public.vars.maps.cedarMapJsLib,function(){q.wcshm.public.fn.injectScript(q.wcshm.public.vars.common.info.alopeyk.wcshm.map.leaflet_gesture_handling.js,alopeykHandleMapsPublic)}),q.wcshm.public.fn.injectStylesheet(q.wcshm.public.vars.maps.cedarMapCssLib),q.wcshm.public.fn.injectStylesheet(q.wcshm.public.vars.common.info.alopeyk.wcshm.map.leaflet_gesture_handling.css)))},handleMaps:function(){S(document).trigger("alopeyk:public:map:loaded")},initMaps:function(){S(document).on("alopeyk:public:map:loaded",function(){var a=S(q.wcshm.public.vars.maps.destinationLatInput),s=S(q.wcshm.public.vars.maps.destinationLngInput),e=S(q.wcshm.public.vars.maps.destinationAddressInput),t=S(q.wcshm.public.vars.maps.destinationNumberInput),i=S(q.wcshm.public.vars.maps.destinationUnitInput),n=S(q.wcshm.public.vars.maps.shippingAddress1Input),c=S(q.wcshm.public.vars.maps.shippingAddress2Input),o=S(q.wcshm.public.vars.maps.billingAddress1Input),l=S(q.wcshm.public.vars.maps.billingAddress2Input),p=S(q.wcshm.public.vars.maps.billing_address_1_field),r=S(q.wcshm.public.vars.maps.addressDetailsFields),m=S(q.wcshm.public.vars.maps.shipToDifferentAddressInput),u=S(q.wcshm.public.vars.maps.editAddressButton),d=q.wcshm.public.vars.maps.billing_country,h=q.wcshm.public.vars.maps.shipping_country,v=q.wcshm.public.vars.maps.billing_city,b=q.wcshm.public.vars.maps.shipping_city,g=q.wcshm.public.vars.maps.billing_state,w=q.wcshm.public.vars.maps.shipping_state,f=q.wcshm.public.vars.maps.select2Class,y=q.wcshm.public.vars.maps.awcshmLoadingField,_=q.wcshm.public.vars.maps.woocommerce_checkout_class,C=q.wcshm.public.vars.maps.wc_add_alopeyk;a.length&&s.length&&e.length&&q.wcshm.public.fn.initDestinationLocator(a,s,e,t,i,n,c,o,l,p,m,u,r,d,h,v,b,g,w,_,C,f,y)}),q.wcshm.public.fn.loadCedarMaps()},setCurrentGeolocation:function(a){var s=q.wcshm.public.vars.common.destinationMap,e=s?s.mapObject:null,t=S(q.wcshm.public.vars.maps.destinationLatInput),i=S(q.wcshm.public.vars.maps.destinationLngInput);navigator.geolocation&&e&&t.length&&i.length&&(a||!t.val().length&&!i.val().length||t.val()==q.wcshm.public.vars.maps.defaultCenter.lat&&destinationngInput.val()==q.wcshm.public.vars.maps.defaultCenter.lng)&&navigator.geolocation.getCurrentPosition(function(a){q.wcshm.public.vars.maps.fetchAddressConnection&&q.wcshm.public.vars.maps.fetchAddressConnection.abort(),e.setView({lat:a.coords.latitude,lng:a.coords.longitude}),q.wcshm.public.vars.maps.defaultCenter.lat=a.coords.latitude,q.wcshm.public.vars.maps.defaultCenter.lng=a.coords.longitude,t.val(a.coords.latitude),i.val(a.coords.longitude).trigger("change")})},initDestinationLocator:function(g,w,f,y,_,C,k,I,x,a,M,s,e,T,A,j,D,P,K,O,F,V,R){var t=function(){var a=q.wcshm.public.vars.common.info.alopeyk.wcshm.map.marker,s=S("<div/>").attr({id:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorMapId),class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorMapClass)}),c=f.clone().attr({id:f.attr("id")+"_autocomplete",class:f.attr("class"),placeholder:f.data(q.wcshm.public.vars.maps.autocompletePlaceholderDataAttr),name:"",style:"",type:"text",spellcheck:"false",autocapitalize:"off",autocorrect:"off",autocomplete:"off"}).removeClass(q.wcshm.public.vars.common.disabledClass),e=S("<div>").attr({id:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorInputWrapperId),class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorInputWrapperClass)}),o=S("<ul/>").attr({id:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorAutocompleteResultsClass),class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorAutocompleteResultsClass)}),t=S("<div/>").attr({class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.mapContainerClass)}),i=S("<button/>").attr({type:"button",class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorCtaClass)}),n=S("<img/>").attr({src:a,class:q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.mapMarkerIconClass)});e.insertAfter(f).append(c).append(o),s.insertAfter(e),t.insertAfter(s),t.append(s).append(e).append(i).prepend(n),L.cedarmaps.accessToken=q.wcshm.public.vars.common.info.alopeyk.wcshm.map.api_key;var l={zoom:q.wcshm.public.vars.maps.defaultZoom,maxZoom:q.wcshm.public.vars.maps.maxZoom,center:[g.val().length?parseFloat(g.val()):q.wcshm.public.vars.maps.defaultCenter.lat,w.val().length?parseFloat(w.val()):q.wcshm.public.vars.maps.defaultCenter.lng],zoomControl:!1,gestureHandling:!0,gestureHandlingText:{touch:q.wcshm.public.fn.translate("Use two fingers to move the map"),scroll:q.wcshm.public.fn.translate("Use ctrl + scroll to zoom the map"),scrollMac:q.wcshm.public.fn.translate("Use âŒ˜ + scroll to zoom the map")}},p=L.cedarmaps.map(s.get(0),q.wcshm.public.vars.common.info.alopeyk.wcshm.map.api_url.replace("{{TOKEN}}",L.cedarmaps.accessToken),l),r=function(a){var s=o.children(),e=a==s.length?0:a<0?s.length-1:a,t=q.wcshm.public.vars.common.activeClass;s.removeClass(t).eq(e).addClass(t)},m=function(){q.wcshm.public.vars.maps.fetchAddressConnection&&q.wcshm.public.vars.maps.fetchAddressConnection.abort(),e.addClass(q.wcshm.public.vars.common.loadingClass),q.wcshm.public.vars.maps.fetchAddressConnection=S.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"get_address",authenticate:!0,lat:p.getCenter().lat,lng:p.getCenter().lng},function(a){if(a){o.empty(),c.val(a.data.address);var s=j,e=P;M.prop("checked")&&(s=D,e=K);var t=d(s,a.data.city),i=d(e,a.data.province);if(0<t.length?S(s).val(t).triggerHandler("change"):(S(e).val(i).trigger("change"),q.wcshm.public.vars.common.responseDataCity=a.data.city,q.wcshm.public.vars.common.selectedCityType=s),S("."+F).length){var n=a.success?a.data.address:"";f.val(n),C.val(n),k.val(""),M.length&&!M.prop("checked")&&(I.length&&I.val(n),x.length&&x.val(""))}f.trigger("change")}}).always(function(){e.removeClass(q.wcshm.public.vars.common.loadingClass)})},u=function(s){q.wcshm.public.vars.updateShipingMethod&&q.wcshm.public.vars.updateShipingMethod.abort(),f.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return!S(this).is(":disabled")}).prop("disabled",!0).data("alopeyk-disable",!0),q.wcshm.public.vars.updateShipingMethod=S.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"set_session",authenticate:!0,lat:p.getCenter().lat,lng:p.getCenter().lng,address:f.val(),number:y.val(),unit:_.val(),payment_method:S(b+":checked").val()},function(a){a&&a.success&&s&&S("body").trigger("update_checkout"),f.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return S(this).data("alopeyk-disable")}).prop("disabled",!1)})},d=function(a,s){var e=S(a+' option[value="'+s+'"]').val(),t=S(a+" option").filter(function(){return S(this).html()==s}).val();return e&&0<e.length?e:t&&0<t.length?t:""},h=function(i){var n="#"+i+"_city",a="#"+i+"_country";S(n).prop("disabled",!0).parent().find(V).addClass(R),"IR"==S(a).val()?(S(n).empty(),S(n).append(S("<option>",{value:"",text:""})),q.wcshm.public.vars.maps.fetchIRCities=S.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"get_iran_cities",selected_state:S("#"+i+"_state option:selected").text()},function(t){if(t){S(n).prop("disabled",!1).parent().find(V).removeClass(R),S.each(t.data.cities,function(a,s){if("null"!==s){var e=void 0;"billing"==i?s.name==t.data.pre_billing_city&&(e="selected"):"shipping"==i&&s.name==t.data.pre_shipping_city&&(e="selected"),S(n).append(S("<option>",{value:s.name,text:s.name,attr:{cedar_center:s.location.center,selected:e}}))}});var a="";""!=q.wcshm.public.vars.common.selectedCityType&&q.wcshm.public.vars.common.selectedCityType==n&&0<(a=d(n,q.wcshm.public.vars.common.responseDataCity)).length&&S(n).val(a),q.wcshm.public.vars.common.selectedCityType="",S(n).trigger("change")}})):S(n).prop("disabled",!1).parent().find(V).removeClass(R)},v=function(a){var s="#"+a+"_city";if("IR"==S("#"+a+"_country").val()){var e=S(s).find("option:selected");if(0<e.text().length){var t=e.attr("cedar_center");if(t=t.split(","),q.wcshm.public.vars.common.responseDataCity!=e.val()&&t&&0<t.length&&(g.val(t[0]),w.val(t[1]).trigger("change"),S(O).removeClass(F)),"yes"==q.wcshm.public.vars.common.info.alopeyk.wcshm.config.out_service_city)S(O).addClass(F);else if(S(O).removeClass(F),"no"==q.wcshm.public.vars.common.info.alopeyk.wcshm.config.intercity){var i=e.val();S(O).addClass(F),i!=q.wcshm.public.vars.common.info.alopeyk.wcshm.config.store_city&&S(O).removeClass(F)}else q.wcshm.public.vars.maps.autocompleteConnection=S.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"get_address",admin_dashboard:!0,authenticate:!0,lat:t[0],lng:t[1]},function(a){a.success?S(O).addClass(F):S(O).removeClass(F)})}}else S(O).removeClass(F)},b=q.wcshm.public.vars.common.paymentMethodInput;!function(){if(S(j).parent().find(V).addClass(R),S(D).parent().find(V).addClass(R),h("billing"),h("shipping"),"yes"==q.wcshm.public.vars.common.info.alopeyk.wcshm.config.out_service_city){var a=T;M.prop("checked")&&(a=A),"IR"==S(a).val()&&(S(O).addClass(F),m())}}(),S(document).on("change",P,function(a){h("billing")}).on("change",K,function(a){h("shipping")}).on("change",j,function(a){M.prop("checked")||v("billing")}).on("change",D,function(a){M.prop("checked")&&v("shipping")}),L.control.zoom({position:"bottomright"}).addTo(p),q.wcshm.public.vars.common.destinationMap={mapObject:p},q.wcshm.public.vars.common.info.woocommerce.checkout&&(S(document).on("change",b+", #"+f.attr("id"),function(){u(!0)}),S.merge(y,_).on("change paste keyup input propertychange",function(){q.wcshm.public.vars.maps.addressDetailKeyupTimeout&&clearTimeout(q.wcshm.public.vars.maps.addressDetailKeyupTimeout),q.wcshm.public.vars.maps.addressDetailKeyupTimeout=setTimeout(function(){u(!1)},q.wcshm.public.vars.maps.autoCompleteKeyupDelay)})),p.on("move dragend zoomend",function(){g.val(p.getCenter().lat),w.val(p.getCenter().lng).trigger("change")}),S.merge(g,w).on("change paste keyup input propertychange",function(){q.wcshm.public.vars.maps.latitudeValue==g.val()&&q.wcshm.public.vars.maps.longitudeValue==w.val()||(q.wcshm.public.vars.maps.latitudeValue=g.val(),q.wcshm.public.vars.maps.longitudeValue=w.val(),q.wcshm.public.vars.maps.positionKeyupTimeout&&clearTimeout(q.wcshm.public.vars.maps.positionKeyupTimeout),q.wcshm.public.vars.maps.positionKeyupTimeout=setTimeout(function(){var a={lat:parseFloat(g.val()),lng:parseFloat(w.val())};p.setView(a),m()},q.wcshm.public.vars.maps.positionKeyupDelay))}),M.on("change",function(){var a=S(this).prop("checked");a?v("shipping"):(I.val(C.val()),x.val(k.val()),v("billing"))}).trigger("change"),c.on({keydown:function(a){var s=o.children("."+q.wcshm.public.vars.common.activeClass),e=s.length?s.index():-1;switch(a.which){case 13:a.preventDefault(),s&&s.trigger("click");break;case 27:c.blur();break;case 38:a.preventDefault(),r(e-1);break;case 40:a.preventDefault(),r(e+1)}},"change paste keyup input propertychange":function(a){q.wcshm.public.vars.maps.autocompleteInputValue!=c.val()&&(o.empty(),q.wcshm.public.vars.maps.autocompleteInputValue=c.val(),q.wcshm.public.vars.maps.autocompleteKeyupTimeout&&clearTimeout(q.wcshm.public.vars.maps.autocompleteKeyupTimeout),q.wcshm.public.vars.maps.autocompleteKeyupTimeout=setTimeout(function(){q.wcshm.public.vars.maps.autocompleteConnection&&q.wcshm.public.vars.maps.autocompleteConnection.abort(),e.addClass(q.wcshm.public.vars.common.loadingClass),q.wcshm.public.vars.maps.autocompleteConnection=S.post(q.wcshm.public.vars.common.info.ajaxOptions.url,{nonce:q.wcshm.public.vars.common.info.ajaxOptions.nonce,action:q.wcshm.public.vars.common.info.alopeyk.wcshm.id,request:"suggest_address",authenticate:!0,input:c.val(),lat:p.getCenter().lat,lng:p.getCenter().lng},function(a){if(a&&a.success&&a.data.length){c.focus();for(var s=0;s<a.data.length;s++){var e={lat:parseFloat(a.data[s].lat),lng:parseFloat(a.data[s].lng)},t=a.data[s].address,i=a.data[s].city,n=S("<li>").addClass(q.wcshm.public.fn.addPrefix(q.wcshm.public.vars.maps.destinationLocatorAutocompleteResultClass)).attr("title",t).data({city:i,address:t,location:e}).text(t).on({click:function(){S(this).data("city");var a=S(this).data("address"),s=S(this).data("location");c.blur(),c.val(a),f.val(a),p.setView(s),p.setZoom(q.wcshm.public.vars.maps.defaultZoom),g.val(s.lat),w.val(s.lng),q.wcshm.public.vars.maps.autocompleteInputValue=a,C.val(a),k.val(""),M.length&&!M.prop("checked")&&(I.length&&I.val(a),x.length&&x.val("")),m()},hover:function(){r(S(this).index())}});o.append(n)}}}).always(function(){e.removeClass(q.wcshm.public.vars.common.loadingClass)})},q.wcshm.public.vars.maps.autoCompleteKeyupDelay))}}),i.on("click",function(){q.wcshm.public.fn.setCurrentGeolocation(!0)}),q.wcshm.public.fn.setCurrentGeolocation()};s.length&&s.is(":visible")?s.on("click",function(){t()}):t()},init:function(){}},S(document).on({ready:function(a){q.wcshm.public.fn.init()}}),S(window).on({load:function(a){q.wcshm.public.fn.initMaps()}})}(jQuery);