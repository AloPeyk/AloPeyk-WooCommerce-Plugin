!function(a){"use strict";var e=e||{wcshm:{}};e.wcshm.admin={},e.wcshm.admin.vars={common:{info:window.awcshm,time:Date.now(),activeClass:"active",loadingClass:"loading",disabledClass:"disabled",alopeykPrefix:"awcshm-",checkboxToggleIdDataAttr:"checkbox-toggle-id",checkboxToggleTargetDataAttr:"checkbox-toggle-target",knownImageExtensions:["jpg","jpeg","gif","tiff","png","apng","bmp","svg"],modalContentClass:"modal-content"},maps:{selector:".map-canvas",storeLatInputName:"store_lat",storeLngInputName:"store_lng",storeCityInputName:"store_city",storeAddressInputName:"store_address",storeLocatorMapClass:"map-canvas store-locator-map",storeLocatorInputWrapperClass:"store-locator-input-wrapper",storeLocatorAutocompleteResultsClass:"store-locator-autocomplete-results",mapMarkerIconClass:"map-marker-icon",storeLocatorAutocompleteResultClass:"store-locator-autocomplete-result",storeLocatorHiddenableInput:".hide-parent-row",autocompletePlaceholderDataAttr:"autocomplete-placeholder",autocompleteKeyupTimeout:null,positionKeyupTimeout:null,autoCompleteKeyupDelay:500,positionKeyupDelay:500,defaultZoom:15,maxZoom:17,defaultCenter:{lat:35.6996468,lng:51.3377773},parsiMapJsLib:"https://www.parsimap.com/docs/leaflet/v1.5.1/leaflet.js",parsiMapCssLib:"https://www.parsimap.com/docs/leaflet/v1.5.1/leaflet.css"},cost:{costTypeInputName:"cost_type",staticCostTypeInputName:"static_cost_type",fixedCostInputName:"static_cost_fixed",percentageCostInputName:"static_cost_percentage",costTypeDynamicVal:"dynamic",costTypeStaticVal:"static",staticCostTypeFixedVal:"fixed",staticCostTypePercentageVal:"percentage"},upload:{inputSelector:".input-upload",assetsContainerClass:"upload-assets-container",previewContainerClass:"preview-container",previewTypePrefix:"preview-type-",uploadButtonClass:"button-primary upload-button",removeButtonClass:"button button-small remove-button",filenameLabelClass:"filename-label",uploadLabelDataAttr:"upload-label",removeLabelDataAttr:"remove-label",uploadOptionsDataAttr:"upload-options",isEmptyClass:"is-empty",isFilledClass:"is-filled"},prompts:{headingElement:"h2",headingContainer:"#mainform",belowHeadingElements:".below-heading"},bulkAction:{actionValue:"alopeyk_cumulative_shipping",formElement:".post-type-shop_order #posts-filter",submitElement:"#doaction, #doaction2",actionInputs:'[name="post[]"]:checked',dropdownElement:"#bulk-action-selector-bottom, #bulk-action-selector-top"},forms:{priceInputsClass:"price-input",dateDropdownElement:'[name="ship_date"]',hourDropdownElement:'[name="ship_hour"]',minuteDropdownElement:'[name="ship_minute"]',shipNowTogglerElement:'[name="ship_now"]',createOrderFormClass:"create-order-form",customerScoreExchangeCardClass:"customer-score-exchange-card",discountCopunFormClass:"add-discount-coupon-form",creditButtonElementClass:"amount-button",creditButtonAmountDataAttr:"credit-amount",creditButtonTargetDataAttr:"credit-target",addCouponFormClass:"add-coupon-form",cancelOrderFormClass:"cancel-order-form",rateOrderFormClass:"rate-order-form",addCustomerScoreExchangeFormClass:"add-customer-score-exchange-form"},modals:{creditModalTogglerClass:"credit-modal-toggler",creditModalAmountDataAttr:"credit-amount",orderModalTogglerClass:"order-modal-toggler",orderModalTypeDataAttr:"order-types",orderModalOrdersDataAttr:"order-ids",orderModalDescriptionDataAttr:"order-description",orderModalOrdersDelimiter:",",couponModalTogglerClass:"coupon-modal-toggler",customerScoreExchangeModalTogglerClass:"customer-score-exchange-modal-toggler",cancelModalTogglerClass:"cancel-modal-toggler",cancelModalOrderDataAttr:"order-id",rateModalTogglerClass:"rate-modal-toggler",rateModalOrderDataAttr:"order-id",uiWidgetOverlay:".ui-widget-overlay",orderFormData:"",oldOrderFormData:"",removeDiscountCouponClass:"remove-discount-coupon",cancelButtonClass:"modal-cancel-button"},chat:{togglerInput:"#awcshm-support-chat-toggler"},endpoint:{environmentInputName:"environment",endpointUrl:"endpoint_url",endpointApiUrl:"endpoint_api_url",endpointTrackingUrl:"endpoint_tracking_url",environmentTypeCustomVal:"custom"}},e.wcshm.admin.fn={addPrefix:function(a){for(var n=[],t=a.split(" "),s=0;s<t.length;s++)n.push(e.wcshm.admin.vars.common.alopeykPrefix+t[s]);return n.join(" ")},translate:function(a){var n=e.wcshm.admin.vars.common.info.translations[a];return n||a},getUrlVars:function(a){for(var e=[],n=(a=a||window.location.href).indexOf("?"),t=-1!=n?decodeURIComponent(a).slice(n+1):null,s=(e=t?t.split("&"):[],[]),o=0;o<e.length;o++){var r=e[o].split("=");if(r[0]=r[0].replace("[]",""),void 0===r[1]&&(r[1]=""),void 0===s[r[0]])s[r[0]]=r[1];else if("string"==typeof s[r[0]]){var i=[s[r[0]],r[1]];s[r[0]]=i}else s[r[0]].push(r[1])}return"object"==typeof s?s:null},openTab:function(n){var t=a("<form>"),s=e.wcshm.admin.fn.getUrlVars(n);if(s&&Object.keys(s).length)for(var o in s)s.hasOwnProperty(o)&&t.append(a("<input>").attr({type:"hidden",name:o,value:s[o]}));t.attr({action:n,method:"GET",target:"_blank"}).appendTo("body").trigger("submit").remove()},decodeToHtml:function(a){var e=document.createElement("textarea");return e.innerHTML=a,e.value},injectScript:function(e,n){var t,s;a('[src="'+e+'"]').length||((t=document.createElement("script")).type="text/javascript",t.async=!0,t.src=e,t.onload=n||!1,(s=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,s))},injectStylesheet:function(e){var n,t;a('[href="'+e+'"]').length||((n=document.createElement("link")).type="text/css",n.rel="stylesheet",n.href=e,(t=document.getElementsByTagName("link")[0]).parentNode.insertBefore(n,t))},loadCedarMaps:function(){window.alopeykHandleMapsAdmin=e.wcshm.admin.fn.handleMaps,"function"==typeof alopeykHandleMapsAdmin&&(void 0!==window.L?(window.cedarMapIsLoading=!1,e.wcshm.admin.fn.handleMaps()):window.cedarMapIsLoading?e.wcshm.admin.vars.loadingMapInterval=setInterval((function(){window.L&&(window.cedarMapIsLoading=!1,clearInterval(e.wcshm.admin.vars.loadingMapInterval),e.wcshm.admin.fn.handleMaps())}),500):(window.cedarMapIsLoading=!0,e.wcshm.admin.fn.injectScript(e.wcshm.admin.vars.maps.parsiMapJsLib,(function(){e.wcshm.admin.fn.injectScript(e.wcshm.admin.vars.common.info.alopeyk.wcshm.map.leaflet_gesture_handling.js,alopeykHandleMapsAdmin)})),e.wcshm.admin.fn.injectStylesheet(e.wcshm.admin.vars.maps.parsiMapCssLib),e.wcshm.admin.fn.injectStylesheet(e.wcshm.admin.vars.common.info.alopeyk.wcshm.map.leaflet_gesture_handling.css)))},handleMaps:function(){a(document).trigger("alopeyk:admin:map:loaded")},initMaps:function(){a(document).on("alopeyk:admin:map:loaded",(function(){if(a("[id$='"+e.wcshm.admin.vars.common.info.alopeyk.wcshm.id+"_tab_parent']")){var n=a("[id$='"+e.wcshm.admin.vars.maps.storeLatInputName+"']"),t=a("[id$='"+e.wcshm.admin.vars.maps.storeLngInputName+"']"),s=a("[id$='"+e.wcshm.admin.vars.maps.storeCityInputName+"']"),o=a("[id$='"+e.wcshm.admin.vars.maps.storeAddressInputName+"']");n.length&&t.length&&s.length&&o.length&&e.wcshm.admin.fn.initStoreLocator(n.first(),t.first(),s.first(),o.first())}})),e.wcshm.admin.fn.loadCedarMaps()},initStoreLocator:function(n,t,s,o){var r=e.wcshm.admin.vars.common.info.alopeyk.wcshm.map.marker,i=a("<div/>").attr({id:"store-locator-map",class:e.wcshm.admin.vars.maps.storeLocatorMapClass}),d=o.clone().attr({id:o.attr("id")+"_autocomplete",class:o.attr("class").replace("hidden",""),placeholder:o.data(e.wcshm.admin.vars.maps.autocompletePlaceholderDataAttr),name:"",style:"",value:"",type:"text",spellcheck:"false",autocapitalize:"off",autocorrect:"off",autocomplete:"off"}).removeClass(e.wcshm.admin.vars.common.disabledClass),c=a("<div/>").attr({id:"store-locator-input-wrapper",class:e.wcshm.admin.vars.maps.storeLocatorInputWrapperClass}),m=a("<ul/>").attr({id:"store-locator-autocomplete-results",class:e.wcshm.admin.vars.maps.storeLocatorAutocompleteResultsClass}),l=a("<img/>").attr({src:r,class:e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.maps.mapMarkerIconClass)});c.insertAfter(o).append(d).append(m),i.insertAfter(c).prepend(l);var h={zoom:e.wcshm.admin.vars.maps.defaultZoom,maxZoom:e.wcshm.admin.vars.maps.maxZoom,center:[n.val().length?parseFloat(n.val()):e.wcshm.admin.vars.maps.defaultCenter.lat,t.val().length?parseFloat(t.val()):e.wcshm.admin.vars.maps.defaultCenter.lng],zoomControl:!1,gestureHandling:!0,gestureHandlingText:{touch:e.wcshm.admin.fn.translate("Use two fingers to move the map"),scroll:e.wcshm.admin.fn.translate("Use ctrl + scroll to zoom the map"),scrollMac:e.wcshm.admin.fn.translate("Use âŒ˜ + scroll to zoom the map")}},p=L.map(i.get(0),h),u=function(a){var n=m.children(),t=a==n.length?0:a<0?n.length-1:a,s=e.wcshm.admin.vars.common.activeClass;n.removeClass(s).eq(t).addClass(s)},f=function(){e.wcshm.admin.vars.maps.fetchAddressConnection&&e.wcshm.admin.vars.maps.fetchAddressConnection.abort(),o.parents("form").find('button, input[type="button"], input[type="submit"]').filter((function(){return!a(this).is(":disabled")})).prop("disabled",!0).data("alopeyk-disable",!0),c.addClass(e.wcshm.admin.vars.common.loadingClass),e.wcshm.admin.vars.maps.fetchAddressConnection=a.post(e.wcshm.admin.vars.common.info.ajaxOptions.url,{nonce:e.wcshm.admin.vars.common.info.ajaxOptions.nonce,action:e.wcshm.admin.vars.common.info.alopeyk.wcshm.id,request:"get_address",scope:"admin",authenticate:!0,lat:p.getCenter().lat,lng:p.getCenter().lng},(function(e){e&&(m.empty(),s.val(e.success&&e.data.city?e.data.city:""),d.val(e.data.address),o.val(e.success?e.data.address:""),e.success?o.parents("form").find('button, input[type="button"], input[type="submit"]').filter((function(){return a(this).data("alopeyk-disable")})).prop("disabled",!1):(n.val(""),t.val("")))})).always((function(){c.removeClass(e.wcshm.admin.vars.common.loadingClass)}))};L.control.zoom({position:"bottomright"}).addTo(p),L.tileLayer(e.wcshm.admin.vars.common.info.alopeyk.wcshm.map.api_url.replace("{{TOKEN}}",e.wcshm.admin.vars.common.info.alopeyk.wcshm.map.api_key)).addTo(p),p.on("move",(function(){n.val(p.getCenter().lat),t.val(p.getCenter().lng)})),p.on("dragend",(function(){f()})),a.merge(n,t).on("change paste keyup input propertychange",(function(){e.wcshm.admin.vars.maps.latitudeValue==n.val()&&e.wcshm.admin.vars.maps.longitudeValue==t.val()||(e.wcshm.admin.vars.maps.latitudeValue=n.val(),e.wcshm.admin.vars.maps.longitudeValue=t.val(),e.wcshm.admin.vars.maps.positionKeyupTimeout&&clearTimeout(e.wcshm.admin.vars.maps.positionKeyupTimeout),e.wcshm.admin.vars.maps.positionKeyupTimeout=setTimeout((function(){var a={lat:parseFloat(n.val()),lng:parseFloat(t.val())};p.setView(a),f()}),e.wcshm.admin.vars.maps.positionKeyupDelay))})),d.on({keydown:function(a){var n=m.children("."+e.wcshm.admin.vars.common.activeClass),t=n.length?n.index():-1;switch(a.which){case 13:a.preventDefault(),n&&n.trigger("click");break;case 27:d.blur();break;case 38:a.preventDefault(),u(t-1);break;case 40:a.preventDefault(),u(t+1)}},"change paste keyup input propertychange":function(r){e.wcshm.admin.vars.maps.autocompleteInputValue!=d.val()&&(m.empty(),e.wcshm.admin.vars.maps.autocompleteInputValue=d.val(),e.wcshm.admin.vars.maps.autocompleteKeyupTimeout&&clearTimeout(e.wcshm.admin.vars.maps.autocompleteKeyupTimeout),e.wcshm.admin.vars.maps.autocompleteKeyupTimeout=setTimeout((function(){e.wcshm.admin.vars.maps.autocompleteConnection&&e.wcshm.admin.vars.maps.autocompleteConnection.abort(),c.addClass(e.wcshm.admin.vars.common.loadingClass),e.wcshm.admin.vars.maps.autocompleteConnection=a.post(e.wcshm.admin.vars.common.info.ajaxOptions.url,{nonce:e.wcshm.admin.vars.common.info.ajaxOptions.nonce,action:e.wcshm.admin.vars.common.info.alopeyk.wcshm.id,request:"suggest_address",scope:"admin",authenticate:!0,input:d.val(),lat:p.getCenter().lat,lng:p.getCenter().lng},(function(r){if(r&&r.success&&r.data.length){d.focus();for(var i=0;i<r.data.length;i++){var c={lat:parseFloat(r.data[i].lat),lng:parseFloat(r.data[i].lng)},l=r.data[i].address,h=r.data[i].city,w=a("<li>").addClass(e.wcshm.admin.vars.maps.storeLocatorAutocompleteResultClass).attr("title",l).data({city:h,address:l,location:c}).text(l).on({click:function(){var r=a(this).data("city"),i=a(this).data("address"),c=a(this).data("location");d.blur(),d.val(i),o.val(i),s.val(r),p.setView(c),p.setZoom(e.wcshm.admin.vars.maps.defaultZoom),n.val(c.lat),t.val(c.lng),e.wcshm.admin.vars.maps.autocompleteInputValue=i,f()},hover:function(){u(a(this).index())}});m.append(w)}}})).always((function(){c.removeClass(e.wcshm.admin.vars.common.loadingClass)}))}),e.wcshm.admin.vars.maps.autoCompleteKeyupDelay))}})},handleSettingFields:function(){if(a("[id$='"+e.wcshm.admin.vars.common.info.alopeyk.wcshm.id+"_tab_parent']")){var n=a("[id$='"+e.wcshm.admin.vars.cost.costTypeInputName+"']"),t=a("[id$='"+e.wcshm.admin.vars.cost.staticCostTypeInputName+"']"),s=a("[id$='"+e.wcshm.admin.vars.cost.fixedCostInputName+"']"),o=a("[id$='"+e.wcshm.admin.vars.cost.percentageCostInputName+"']"),r=a("[id$='"+e.wcshm.admin.vars.endpoint.environmentInputName+"']"),i=a("[id$='"+e.wcshm.admin.vars.endpoint.endpointUrl+"']"),d=a("[id$='"+e.wcshm.admin.vars.endpoint.endpointApiUrl+"']"),c=a("[id$='"+e.wcshm.admin.vars.endpoint.endpointTrackingUrl+"']"),m=e.wcshm.admin.vars.common.checkboxToggleTargetDataAttr,l=e.wcshm.admin.vars.common.checkboxToggleIdDataAttr,h=e.wcshm.admin.vars.upload.inputSelector,p=function(){n.val()==e.wcshm.admin.vars.cost.costTypeDynamicVal?(t.parents("tr").css("display","none"),s.parents("tr").css("display","none"),o.parents("tr").css("display","none")):n.val()==e.wcshm.admin.vars.cost.costTypeStaticVal&&(t.parents("tr").css("display",""),t.val()==e.wcshm.admin.vars.cost.staticCostTypeFixedVal?(s.parents("tr").css("display",""),o.parents("tr").css("display","none")):(o.parents("tr").css("display",""),s.parents("tr").css("display","none")))},u=function(){r.val()==e.wcshm.admin.vars.endpoint.environmentTypeCustomVal?(i.parents("tr").css("display",""),d.parents("tr").css("display",""),c.parents("tr").css("display","")):(i.parents("tr").css("display","none"),d.parents("tr").css("display","none"),c.parents("tr").css("display","none"))};a.merge(n,t).on("change",p),p(),r.on("change",u),u(),a("input:checkbox[data-"+m+"]").on("change",(function(){var e=a("input:checkbox[data-"+l+'="'+a(this).data(m)+'"]'),n=a("input:checkbox[data-"+l+'="'+e.data(m)+'"]');e.parents("tr").css("display",a(this).prop("checked")?"":"none"),n.length&&n.parents("tr").css("display",a(this).prop("checked")&&e.prop("checked")?"":"none")})).trigger("change"),a(e.wcshm.admin.vars.maps.storeLocatorHiddenableInput).parents("tr").first().css("display","none"),a.each(a(h),(function(n,t){var s=(t=a(t)).val(),o={frame:"post",state:"insert",multiple:!1},r=e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.previewContainerClass),i=a("<div>").addClass(e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.assetsContainerClass)),d=a("<div>").addClass(r).appendTo(i),c=a("<span>").addClass(e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.filenameLabelClass)).appendTo(d);a("<button>").attr("type","button").addClass(e.wcshm.admin.vars.upload.uploadButtonClass).html(t.data(e.wcshm.admin.vars.upload.uploadLabelDataAttr)).appendTo(i).on("click",(function(n){n.preventDefault();var s=t.data(e.wcshm.admin.vars.upload.uploadOptionsDataAttr);s=a.extend({},o,s||{});var i=wp.media(s);i.on("insert",(function(){var n=i.state().get("selection").first().toJSON();t.val(n.url).trigger("change"),c.text(n.filename),d.removeClass().addClass(r).addClass(e.wcshm.admin.vars.upload.previewTypePrefix+n.subtype),-1!=a.inArray(n.subtype,e.wcshm.admin.vars.common.knownImageExtensions)&&d.css("background-image","url("+n.url+")")})).open()})),a("<button>").attr("type","button").addClass(e.wcshm.admin.vars.upload.removeButtonClass).html(t.data(e.wcshm.admin.vars.upload.removeLabelDataAttr)).appendTo(d).on("click",(function(a){a.preventDefault(),t.val("").trigger("change"),c.text(""),d.removeClass().addClass(r).css("background-image","")}));if(i.insertAfter(t),s.length){var m=s.split("/").pop(),l=s.split(".").pop();c.text(m),d.removeClass().addClass(r).addClass(e.wcshm.admin.vars.upload.previewTypePrefix+l),-1!=a.inArray(l,e.wcshm.admin.vars.common.knownImageExtensions)&&d.css("background-image","url("+s+")")}t.on("change paste keyup input propertychange",(function(){var n=!a(this).val().length,t=e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.isEmptyClass),s=e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.isFilledClass);i.removeClass(n?s:t).addClass(n?t:s)})).trigger("change")}))}},handleBelowHeadingElements:function(){var n=a(e.wcshm.admin.vars.prompts.headingContainer),t=a(e.wcshm.admin.vars.prompts.belowHeadingElements);n.length&&t.insertBefore(n.find(e.wcshm.admin.vars.prompts.headingElement).first())},handleBulkAction:function(){var n=e.wcshm.admin.vars.bulkAction.submitElement;a(n).length&&a(document).on("click",n,(function(n){var t=[],s=a(e.wcshm.admin.vars.bulkAction.dropdownElement);if(a.each(s,(function(){t.push(a(this).val())})),-1!=a.inArray(e.wcshm.admin.vars.bulkAction.actionValue,t)){n.preventDefault();var o=[];a.each(a(e.wcshm.admin.vars.bulkAction.actionInputs),(function(){o.push(a(this).val())})),e.wcshm.admin.fn.createOrderModal(o)}}))},showModal:function(n,t,s,o,r,i,d,c){var m={modal:!0,autoOpen:!0,closeOnEscape:!0,draggable:!1,resizable:!1,width:420,minHeight:24,open:function(){var n=a(this);i?n.dialog("option","buttons",r):e.wcshm.admin.vars.activeModalConnection=a.post(e.wcshm.admin.vars.common.info.ajaxOptions.url,{nonce:e.wcshm.admin.vars.common.info.ajaxOptions.nonce,action:e.wcshm.admin.vars.common.info.alopeyk.wcshm.id,request:s,scope:"admin",data:o},(function(a){if(a&&a.success)n.data("response",a.extra?a.extra:null).html(a.data).dialog("option","buttons",r),d&&"function"==typeof d&&d(n);else{var t=a?a.data?a.data:a.toString():e.wcshm.admin.fn.translate("Unkown error occurred.");n.html('<div class="error notice"><p>'+t+"</p></div>")}})).fail((function(a){n.html('<div class="error notice"><p><strong>'+e.wcshm.admin.fn.translate("Request failed:")+"</strong> "+e.wcshm.admin.fn.translate(a.statusText)+"</p></div>")})),a(e.wcshm.admin.vars.modals.uiWidgetOverlay).on("click",(function(){n.dialog("destroy")}))},close:function(){var n=a(this),t=e.wcshm.admin.vars.activeModalConnection;n.dialog("destroy"),t&&t.abort()}};c=a.extend({},m,c||{}),t&&(c.title=t);var l=a("<div>").attr("align","center").append(a("<img>").attr("src",e.wcshm.admin.vars.common.info.alopeyk.wcshm.loader));a("<div>").attr("id",n?e.wcshm.admin.fn.addPrefix("modal-"+n):null).addClass(e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.common.modalContentClass)).html(i||l).dialog(c)},createOrderModal:function(n,t,s){var o=[{text:e.wcshm.admin.fn.translate("Cancel"),class:e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.cancelButtonClass),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Ship"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}],r={type:t,orders:n,description:s};e.wcshm.admin.fn.showModal("create-order",e.wcshm.admin.fn.translate("Ship via Alopeyk"),"create_order_modal",r,o,null,(function(){e.wcshm.admin.fn.handleDateTimeFilters()}))},createCreditModal:function(n){var t=[{text:e.wcshm.admin.fn.translate("Cancel"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Charge account with gift card"),click:function(){e.wcshm.admin.fn.createCouponModal()}},{text:e.wcshm.admin.fn.translate("Pay"),class:"button-primary",click:function(){if(a(this).find('[type="submit"]').trigger("click").parents("form").get(0).checkValidity()){a(this).dialog("destroy");var n=a("#"+e.wcshm.admin.fn.addPrefix("modal-check-order"));n.length&&n.dialog("destroy")}}}],s={amount:n};e.wcshm.admin.fn.showModal("create-credit",e.wcshm.admin.fn.translate("Increase credit"),"create_credit_modal",s,t,null)},createCouponModal:function(){var n=[{text:e.wcshm.admin.fn.translate("Cancel"),class:e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.cancelButtonClass),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Apply"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}];e.wcshm.admin.fn.showModal("create-coupon",e.wcshm.admin.fn.translate("Charge account with gift card"),"create_coupon_modal",null,n,null)},createCustomerScoreExchangeModal:function(){var n=[{text:e.wcshm.admin.fn.translate("Cancel"),class:e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.cancelButtonClass),click:function(){a(this).dialog("destroy")}}];e.wcshm.admin.fn.showModal("create-customer-score-exchange",e.wcshm.admin.fn.translate("Convert Alopeyk Scores to Credit"),"create_customer_score_exchange_modal",null,n,null,(function(){}),{width:610})},createCheckCustomerScoreExchangeModalPre:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.customerScoreExchangeCardClass),(function(n){n.preventDefault(),e.wcshm.admin.fn.createCheckCustomerScoreExchangeModal(a(this).data("id"))}))},createCheckCustomerScoreExchangeModal:function(n){var t=[{text:e.wcshm.admin.fn.translate("Cancel"),class:e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.cancelButtonClass),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Submit"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}];e.wcshm.admin.fn.showModal("submit-customer-score-exchange",e.wcshm.admin.fn.translate("Submit Order"),"submit_customer_score_exchange_modal",n,t,null)},handleAddCustomerScoreExchangeForm:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.addCustomerScoreExchangeFormClass),(function(n){n.preventDefault();var t=a(this).serialize();e.wcshm.admin.fn.showModal("add-customer-score-exchange",e.wcshm.admin.fn.translate("Order Status"),"add_customer_score_exchange_modal",t,null,null,(function(){var n=a("#"+e.wcshm.admin.fn.addPrefix("modal-submit-customer-score-exchange")),t=a("#"+e.wcshm.admin.fn.addPrefix("modal-create-customer-score-exchange"));n.length&&n.dialog("destroy"),t.length&&t.dialog("destroy"),a(document).trigger("awcshm:credit:add")}))}))},createCancelModal:function(n){var t=[{text:e.wcshm.admin.fn.translate("Cancel Order"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}],s={order:n};e.wcshm.admin.fn.showModal("cancel-order",e.wcshm.admin.fn.translate("Cancel Alopeyk Order"),"create_cancel_modal",s,t,null)},createRateModal:function(n){var t=[{text:e.wcshm.admin.fn.translate("Close"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Submit"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}],s={order:n};e.wcshm.admin.fn.showModal("rate-order",e.wcshm.admin.fn.translate("Rate Alopeyk Courier"),"create_rate_modal",s,t,null,(function(a){a.find('input[type="radio"]').on("change",(function(){a.dialog("option","position",{of:window,my:"center",at:"center"})}))}))},handleDateTimeFilters:function(){var n=0,t=e.wcshm.admin.vars.common.info.alopeyk.wcshm.scope.schedule_dates.dates,s=e.wcshm.admin.vars.common.info.alopeyk.wcshm.scope.schedule_dates.steps,o=a(e.wcshm.admin.vars.forms.dateDropdownElement).filter((function(){return!a(this).data("alopeyk-initiated")})).data("alopeyk-initiated",!0),r=a(e.wcshm.admin.vars.forms.hourDropdownElement).filter((function(){return!a(this).data("alopeyk-initiated")})).data("alopeyk-initiated",!0),i=a(e.wcshm.admin.vars.forms.minuteDropdownElement).filter((function(){return!a(this).data("alopeyk-initiated")})).data("alopeyk-initiated",!0);if(o.length&&r.length&&i.length&&t&&Object.keys(t).length){for(var d in o.children().remove().end().on("change",(function(){r.children().remove();for(var t=a(this).find(":selected"),s=parseInt(t.data("initial_hour")),o=(parseInt(t.data("initial_minute")),s);o<24;o++){var i=e.wcshm.admin.fn.pad(o,2,"0");a("<option>").attr("value",i).attr("selected",n==o).text(i).appendTo(r)}r.trigger("change")})),s=Math.max(1,parseInt(s)),r.children().remove().end().on("change",(function(){i.children().remove();var t=o.find(":selected"),r=parseInt(t.data("initial_hour")),d=parseInt(a(this).find(":selected").val()),c=parseInt(t.data("initial_minute"));n=d;for(var m=r==d?c:0;m<60;m+=s){var l=e.wcshm.admin.fn.pad(m,2,"0");a("<option>").attr("value",l).attr("selected",0==m).text(l).appendTo(i)}i.trigger("change")})),t)t.hasOwnProperty(d)&&a("<option>").attr("value",d).text(t[d].label).appendTo(o).data("initial_hour",t[d].initial_hour).data("initial_minute",t[d].initial_minute);o.trigger("change"),r.trigger("change")}},pad:function(a,e,n){return n=n||"0",(a+="").length>=e?a:new Array(e-a.length+1).join(n)+a},handleCheckOrderFormPre:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.createOrderFormClass),(function(n){n.preventDefault(),e.wcshm.admin.vars.modals.orderFormData=a(this),e.wcshm.admin.fn.handleCheckOrderForm()}))},handleCheckOrderForm:function(n){var t=[{text:e.wcshm.admin.fn.translate("Cancel"),class:e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.cancelButtonClass),click:function(){a(this).dialog("destroy")}}],s=e.wcshm.admin.vars.modals.orderFormData,o="string"==a.type(s)?s:s.serialize(),r=e.wcshm.admin.fn.getUrlVars("#?"+o);if(n||t.push({text:e.wcshm.admin.fn.translate("Add Discount Coupon"),click:function(){e.wcshm.admin.fn.handleDiscountCopunForm()}}),t.push({text:e.wcshm.admin.fn.translate("Submit"),class:"button-primary",click:function(){var n=[{text:e.wcshm.admin.fn.translate("Track Order"),click:function(){var n=e.wcshm.admin.fn.decodeToHtml(a(this).data("response").tracking_url);e.wcshm.admin.fn.openTab(n)}},{text:e.wcshm.admin.fn.translate("View Order"),class:"button-primary",click:function(){var n=e.wcshm.admin.fn.decodeToHtml(a(this).data("response").edit_url);e.wcshm.admin.fn.openTab(n)}}],t=a(this);t.dialog("destroy"),e.wcshm.admin.fn.showModal("submit-order",e.wcshm.admin.fn.translate("Alopeyk Order"),"submit_order_modal",t.data("response"),n,null,(function(){var n=a("#"+e.wcshm.admin.fn.addPrefix("modal-create-order"));n.length&&n.dialog("destroy"),a(document).trigger("awcshm:order:create")}))}}),"false"==r.ship_now&&r.ship_date&&r.ship_date.length&&r.ship_hour&&r.ship_hour.length&&r.ship_minute&&r.ship_minute.length&&e.wcshm.admin.vars.common.time&&e.wcshm.admin.vars.common.info.time){var i=new Date(parseInt((""+e.wcshm.admin.vars.common.info.time).replace(/-/g,"/")))-new Date(parseInt((""+e.wcshm.admin.vars.common.time).replace(/-/g,"/")));if(new Date(r.ship_date+" "+r.ship_hour+":"+r.ship_minute+":00").getTime()+i>Date.now())e.wcshm.admin.fn.showModal("check-order",e.wcshm.admin.fn.translate("Alopeyk Order"),"check_order_modal",o,t);else{var d=[{text:e.wcshm.admin.fn.translate("No"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Yes"),class:"button-primary",click:function(){a(e.wcshm.admin.vars.forms.shipNowTogglerElement).val(["true"]),o="string"==a.type(s)?s:s.serialize(),a(this).dialog("destroy"),e.wcshm.admin.fn.showModal("check-order",e.wcshm.admin.fn.translate("Alopeyk Order"),"check_order_modal",o,t)}}];e.wcshm.admin.fn.showModal("check-order-time",e.wcshm.admin.fn.translate("Alopeyk Order"),null,null,d,e.wcshm.admin.vars.common.info.alopeyk.wcshm.scope.schedule_dates.error)}}else e.wcshm.admin.fn.showModal("check-order",e.wcshm.admin.fn.translate("Alopeyk Order"),"check_order_modal",o,t)},handleDiscountCopunForm:function(){var n=[{text:e.wcshm.admin.fn.translate("Cancel"),class:e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.cancelButtonClass),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Submit"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}],t=e.wcshm.admin.vars.modals.orderFormData,s=(a(this),"string"==a.type(t)?t:t.serialize());e.wcshm.admin.fn.showModal("discount-coupon",e.wcshm.admin.fn.translate("Alopeyk Order"),"discount_coupon_modal",s,n)},handleDiscountCopunFormSubmitPre:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.discountCopunFormClass),(function(n){n.preventDefault(),e.wcshm.admin.fn.handleDiscountCopunFormSubmit(a(this))}))},handleDiscountCopunFormSubmit:function(n){var t=""!=e.wcshm.admin.vars.modals.oldOrderFormData?e.wcshm.admin.vars.modals.oldOrderFormData:e.wcshm.admin.vars.modals.orderFormData,s="string"==a.type(t)?t:t.serialize()+"&"+n.serialize();e.wcshm.admin.fn.showModal("discount-coupon-submit",e.wcshm.admin.fn.translate("Alopeyk Order"),"discount_coupon_submit_modal",s,null,null,(function(){var n=a("#"+e.wcshm.admin.fn.addPrefix("modal-check-order")),t=a("#"+e.wcshm.admin.fn.addPrefix("modal-discount-coupon")),o=a("#"+e.wcshm.admin.fn.addPrefix("modal-discount-coupon-submit"));t.length&&t.dialog("destroy"),o.length&&o.dialog("destroy"),n.length&&n.dialog("destroy"),e.wcshm.admin.vars.modals.oldOrderFormData=e.wcshm.admin.vars.modals.orderFormData,e.wcshm.admin.vars.modals.orderFormData=s,e.wcshm.admin.fn.handleCheckOrderForm(!0)}))},handleAddCouponForm:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.addCouponFormClass),(function(n){n.preventDefault();var t=a(this).serialize();e.wcshm.admin.fn.showModal("add-coupon",e.wcshm.admin.fn.translate("Alopeyk Coupon"),"add_coupon_modal",t,null,null,(function(){var n=a("#"+e.wcshm.admin.fn.addPrefix("modal-create-coupon")),t=a("#"+e.wcshm.admin.fn.addPrefix("modal-create-credit")),s=a("#"+e.wcshm.admin.fn.addPrefix("modal-check-order"));n.length&&n.dialog("destroy"),t.length&&t.dialog("destroy"),s.length&&s.dialog("destroy"),a(document).trigger("awcshm:credit:add")}))}))},handleRemoveDiscountCoupon:function(){a(document).on("click","."+e.wcshm.admin.vars.modals.removeDiscountCouponClass,(function(n){var t=a("#"+e.wcshm.admin.fn.addPrefix("modal-check-order"));t.length&&t.dialog("destroy"),e.wcshm.admin.vars.modals.orderFormData=e.wcshm.admin.vars.modals.oldOrderFormData,e.wcshm.admin.vars.modals.oldOrderFormData="",e.wcshm.admin.fn.handleCheckOrderForm()}))},handleCancelOrderForm:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.cancelOrderFormClass),(function(n){n.preventDefault();var t=a(this).serialize();e.wcshm.admin.fn.showModal("cancel-order-result",e.wcshm.admin.fn.translate("Cancel Order"),"cancel_result_modal",t,null,null,(function(){var n=a("#"+e.wcshm.admin.fn.addPrefix("modal-cancel-order"));n.length&&n.dialog("destroy"),a(document).trigger("awcshm:order:cancel")}))}))},handleRateOrderForm:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.rateOrderFormClass),(function(n){n.preventDefault();var t=a(this).serialize();e.wcshm.admin.fn.showModal("rate-order-result",e.wcshm.admin.fn.translate("Rate Alopeyk Courier"),"rate_result_modal",t,null,null,(function(){var n=a("#"+e.wcshm.admin.fn.addPrefix("modal-rate-order"));n.length&&n.dialog("destroy"),a(document).trigger("awcshm:order:finish")}))}))},setupCreditModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.creditModalTogglerClass),(function(n){n.preventDefault();var t=a(this).data(e.wcshm.admin.vars.modals.creditModalAmountDataAttr);e.wcshm.admin.fn.createCreditModal(t)}))},setupOrderModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.orderModalTogglerClass),(function(n){n.preventDefault();var t=a(this),s=t.data(e.wcshm.admin.vars.modals.orderModalTypeDataAttr),o=t.data(e.wcshm.admin.vars.modals.orderModalOrdersDataAttr),r=t.data(e.wcshm.admin.vars.modals.orderModalDescriptionDataAttr);o=(o=void 0!==o?o+"":null)&&o.length?o.split(e.wcshm.admin.vars.modals.orderModalOrdersDelimiter):null,e.wcshm.admin.fn.createOrderModal(o,s,r)}))},setupCouponModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.couponModalTogglerClass),(function(a){a.preventDefault(),e.wcshm.admin.fn.createCouponModal()}))},setupCustomerScoreExchangeModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.customerScoreExchangeModalTogglerClass),(function(a){a.preventDefault(),e.wcshm.admin.fn.createCustomerScoreExchangeModal()}))},setupCancelModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.cancelModalTogglerClass),(function(n){n.preventDefault(),e.wcshm.admin.fn.createCancelModal(a(this).data(e.wcshm.admin.vars.modals.cancelModalOrderDataAttr))}))},setupRateModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.rateModalTogglerClass),(function(n){n.preventDefault(),e.wcshm.admin.fn.createRateModal(a(this).data(e.wcshm.admin.vars.modals.rateModalOrderDataAttr))}))},handleAmountButtons:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.creditButtonElementClass),(function(){var n=a(this),t=n.data(e.wcshm.admin.vars.forms.creditButtonAmountDataAttr),s=a(n.data(e.wcshm.admin.vars.forms.creditButtonTargetDataAttr));(s=s&&s.length?s:a("."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.priceInputsClass))).length&&(t=t||0,s.val(t))}))},handlePriceInputs:function(){var n="."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.priceInputsClass);a(document).on("keydown",n,(function(e){-1!==a.inArray(e.keyCode,[46,8,9,27,13,110,190])||/65|67|86|88/.test(e.keyCode)&&(!0===e.ctrlKey||!0===e.metaKey)&&(!0===e.ctrlKey||!0===e.metaKey)||35<=e.keyCode&&40>=e.keyCode||(e.shiftKey||48>e.keyCode||57<e.keyCode)&&(96>e.keyCode||105<e.keyCode)&&e.preventDefault()})),a(document).on("change paste keyup input propertychange",n,(function(e){var n=a(this),t=n.val();n.val(t.replace(/\D/g,""))})).trigger("change")},handlePageUpdates:function(){var n=[],t=parseInt(e.wcshm.admin.vars.common.info.refresh_interval),s=e.wcshm.admin.vars.common.info.dynamic_parts;if(s&&s.length&&(a.each(s,(function(e,t){a(t).length&&n.push(t)})),n.length)){var o=function(){e.wcshm.admin.vars.common.pageUpdateConnection&&e.wcshm.admin.vars.common.pageUpdateConnection.abort(),e.wcshm.admin.vars.common.pageUpdateConnection=a.ajax(window.location.href).done((function(e){var t=a(e);a.each(n,(function(e,n){var s=a(n),o=t.find(n);a(s).text()!=a(o).text()&&s.html(o.html())}))}))};setInterval(o,1e3*(t||10));a(document).on("awcshm:order:create awcshm:order:cancel awcshm:order:finish awcshm:credit:add",o)}},handleChatToggler:function(){a(document).on("change",e.wcshm.admin.vars.chat.togglerInput,(function(){if(a(this).prop("checked")){var e=a(document).height()>a(window).height();a("html, body").stop().animate({scrollTop:0},250,(function(){a("body").scrollTop(0).css("overflow","hidden").parent().css("overflow-y",e?"scroll":"")}))}else a("body").css("overflow","").parent().css("overflow-y","")})),a(e.wcshm.admin.vars.chat.togglerInput).trigger("change")},init:function(){e.wcshm.admin.fn.handlePageUpdates(),e.wcshm.admin.fn.handleChatToggler(),e.wcshm.admin.fn.handlePriceInputs(),e.wcshm.admin.fn.handleAmountButtons(),e.wcshm.admin.fn.handleSettingFields(),e.wcshm.admin.fn.handleBulkAction(),e.wcshm.admin.fn.handleDateTimeFilters(),e.wcshm.admin.fn.handleCheckOrderFormPre(),e.wcshm.admin.fn.handleDiscountCopunFormSubmitPre(),e.wcshm.admin.fn.handleRemoveDiscountCoupon(),e.wcshm.admin.fn.handleCancelOrderForm(),e.wcshm.admin.fn.handleRateOrderForm(),e.wcshm.admin.fn.handleAddCouponForm(),e.wcshm.admin.fn.setupCreditModalTrigger(),e.wcshm.admin.fn.setupOrderModalTrigger(),e.wcshm.admin.fn.setupCancelModalTrigger(),e.wcshm.admin.fn.setupCouponModalTrigger(),e.wcshm.admin.fn.setupCustomerScoreExchangeModalTrigger(),e.wcshm.admin.fn.createCheckCustomerScoreExchangeModalPre(),e.wcshm.admin.fn.handleAddCustomerScoreExchangeForm(),e.wcshm.admin.fn.setupRateModalTrigger(),e.wcshm.admin.fn.handleBelowHeadingElements()}},jQuery((function(){e.wcshm.admin.fn.init()})),a(window).on({load:function(a){e.wcshm.admin.fn.initMaps()}}).resize((function(){a(".ui-dialog-content").dialog("option","position",{my:"center",at:"center",of:window})}))}(jQuery);