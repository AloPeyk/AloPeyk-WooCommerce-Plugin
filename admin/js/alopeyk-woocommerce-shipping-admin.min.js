!function(f){"use strict";var w=w||{wcshm:{}};w.wcshm.admin={},w.wcshm.admin.vars={common:{info:window.awcshm,time:Date.now(),activeClass:"active",loadingClass:"loading",disabledClass:"disabled",alopeykPrefix:"awcshm-",checkboxToggleIdDataAttr:"checkbox-toggle-id",checkboxToggleTargetDataAttr:"checkbox-toggle-target",knownImageExtensions:["jpg","jpeg","gif","tiff","png","apng","bmp","svg"],modalContentClass:"modal-content"},maps:{selector:".map-canvas",storeLatInputName:"store_lat",storeLngInputName:"store_lng",storeCityInputName:"store_city",storeAddressInputName:"store_address",storeLocatorMapClass:"map-canvas store-locator-map",storeLocatorInputWrapperClass:"store-locator-input-wrapper",storeLocatorAutocompleteResultsClass:"store-locator-autocomplete-results",mapMarkerIconClass:"map-marker-icon",storeLocatorAutocompleteResultClass:"store-locator-autocomplete-result",storeLocatorHiddenableInput:".hide-parent-row",autocompletePlaceholderDataAttr:"autocomplete-placeholder",autocompleteKeyupTimeout:null,positionKeyupTimeout:null,autoCompleteKeyupDelay:500,positionKeyupDelay:500,defaultZoom:15,maxZoom:17,defaultCenter:{lat:35.732466,lng:51.413811},cedarMapJsLib:"https://api.cedarmaps.com/cedarmaps.js/v1.8.0/cedarmaps.js",cedarMapCssLib:"https://api.cedarmaps.com/cedarmaps.js/v1.8.0/cedarmaps.css",cedarMapTilesSource:"https://alopeyk.api.cedarmaps.com/v1/tiles/cedarmaps.streets.json?access_token={{TOKEN}}"},cost:{costTypeInputName:"cost_type",staticCostTypeInputName:"static_cost_type",fixedCostInputName:"static_cost_fixed",percentageCostInputName:"static_cost_percentage",costTypeDynamicVal:"dynamic",costTypeStaticVal:"static",staticCostTypeFixedVal:"fixed",staticCostTypePercentageVal:"percentage"},upload:{inputSelector:".input-upload",assetsContainerClass:"upload-assets-container",previewContainerClass:"preview-container",previewTypePrefix:"preview-type-",uploadButtonClass:"button-primary upload-button",removeButtonClass:"button button-small remove-button",filenameLabelClass:"filename-label",uploadLabelDataAttr:"upload-label",removeLabelDataAttr:"remove-label",uploadOptionsDataAttr:"upload-options",isEmptyClass:"is-empty",isFilledClass:"is-filled"},prompts:{headingElement:"h2",headingContainer:"#mainform",belowHeadingElements:".below-heading"},bulkAction:{actionValue:"alopeyk_cumulative_shipping",formElement:".post-type-shop_order #posts-filter",submitElement:"#doaction, #doaction2",actionInputs:'[name="post[]"]:checked',dropdownElement:"#bulk-action-selector-bottom, #bulk-action-selector-top"},forms:{priceInputsClass:"price-input",dateDropdownElement:'[name="ship_date"]',hourDropdownElement:'[name="ship_hour"]',minuteDropdownElement:'[name="ship_minute"]',shipNowTogglerElement:'[name="ship_now"]',createOrderFormClass:"create-order-form",creditButtonElementClass:"amount-button",creditButtonAmountDataAttr:"credit-amount",creditButtonTargetDataAttr:"credit-target",addCouponFormClass:"add-coupon-form",cancelOrderFormClass:"cancel-order-form",rateOrderFormClass:"rate-order-form"},modals:{creditModalTogglerClass:"credit-modal-toggler",creditModalAmountDataAttr:"credit-amount",orderModalTogglerClass:"order-modal-toggler",orderModalTypeDataAttr:"order-types",orderModalOrdersDataAttr:"order-ids",orderModalDescriptionDataAttr:"order-description",orderModalOrdersDelimiter:",",couponModalTogglerClass:"coupon-modal-toggler",cancelModalTogglerClass:"cancel-modal-toggler",cancelModalOrderDataAttr:"order-id",rateModalTogglerClass:"rate-modal-toggler",rateModalOrderDataAttr:"order-id"},chat:{togglerInput:"#awcshm-support-chat-toggler"}},w.wcshm.admin.fn={addPrefix:function(a){for(var e=[],t=a.split(" "),n=0;n<t.length;n++)e.push(w.wcshm.admin.vars.common.alopeykPrefix+t[n]);return e.join(" ")},translate:function(a){var e=w.wcshm.admin.vars.common.info.translations[a];return e||a},getUrlVars:function(a){for(var e=[],t=(a=a||window.location.href).indexOf("?"),n=-1!=t?decodeURIComponent(a).slice(t+1):null,s=(e=n?n.split("&"):[],[]),o=0;o<e.length;o++){var r=e[o].split("=");if(r[0]=r[0].replace("[]",""),void 0===r[1]&&(r[1]=""),void 0===s[r[0]])s[r[0]]=r[1];else if("string"==typeof s[r[0]]){var i=[s[r[0]],r[1]];s[r[0]]=i}else s[r[0]].push(r[1])}return"object"==typeof s?s:null},openTab:function(a){var e=f("<form>"),t=w.wcshm.admin.fn.getUrlVars(a);if(t&&Object.keys(t).length)for(var n in t)t.hasOwnProperty(n)&&e.append(f("<input>").attr({type:"hidden",name:n,value:t[n]}));e.attr({action:a,method:"GET",target:"_blank"}).appendTo("body").trigger("submit").remove()},decodeToHtml:function(a){var e=document.createElement("textarea");return e.innerHTML=a,e.value},injectScript:function(a,e){var t,n;f('[src="'+a+'"]').length||((t=document.createElement("script")).type="text/javascript",t.async=!0,t.src=a,t.onload=e||!1,(n=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,n))},injectStylesheet:function(a){var e,t;f('[href="'+a+'"]').length||((e=document.createElement("link")).type="text/css",e.rel="stylesheet",e.href=a,(t=document.getElementsByTagName("link")[0]).parentNode.insertBefore(e,t))},loadCedarMaps:function(){window.alopeykHandleMapsAdmin=w.wcshm.admin.fn.handleMaps,"function"==typeof alopeykHandleMapsAdmin&&(void 0!==window.L?(window.cedarMapIsLoading=!1,w.wcshm.admin.fn.handleMaps()):window.cedarMapIsLoading?w.wcshm.admin.vars.loadingMapInterval=setInterval(function(){window.L&&(window.cedarMapIsLoading=!1,clearInterval(w.wcshm.admin.vars.loadingMapInterval),w.wcshm.admin.fn.handleMaps())},500):(window.cedarMapIsLoading=!0,w.wcshm.admin.fn.injectScript(w.wcshm.admin.vars.maps.cedarMapJsLib,function(){w.wcshm.admin.fn.injectScript(w.wcshm.admin.vars.common.info.leaflet_gesture_handling.js,alopeykHandleMapsAdmin)}),w.wcshm.admin.fn.injectStylesheet(w.wcshm.admin.vars.maps.cedarMapCssLib),w.wcshm.admin.fn.injectStylesheet(w.wcshm.admin.vars.common.info.leaflet_gesture_handling.css)))},handleMaps:function(){f(document).trigger("alopeyk:admin:map:loaded")},initMaps:function(){f(document).on("alopeyk:admin:map:loaded",function(){var a=w.wcshm.admin.vars.common.info.alopeyk.wcshm.id+"_",e=f("[id$='"+a+w.wcshm.admin.vars.maps.storeLatInputName+"']"),t=f("[id$='"+a+w.wcshm.admin.vars.maps.storeLngInputName+"']"),n=f("[id$='"+a+w.wcshm.admin.vars.maps.storeCityInputName+"']"),s=f("[id$='"+a+w.wcshm.admin.vars.maps.storeAddressInputName+"']");e.length&&t.length&&n.length&&s.length&&w.wcshm.admin.fn.initStoreLocator(e.first(),t.first(),n.first(),s.first())}),w.wcshm.admin.fn.loadCedarMaps()},initStoreLocator:function(r,i,d,c){var a=w.wcshm.admin.vars.common.info.alopeyk.wcshm.map.marker,e=f("<div/>").attr({id:"store-locator-map",class:w.wcshm.admin.vars.maps.storeLocatorMapClass}),m=c.clone().attr({id:c.attr("id")+"_autocomplete",class:c.attr("class"),placeholder:c.data(w.wcshm.admin.vars.maps.autocompletePlaceholderDataAttr),name:"",style:"",value:"",type:"text",spellcheck:"false",autocapitalize:"off",autocorrect:"off",autocomplete:"off"}).removeClass(w.wcshm.admin.vars.common.disabledClass),t=f("<div/>").attr({id:"store-locator-input-wrapper",class:w.wcshm.admin.vars.maps.storeLocatorInputWrapperClass}),l=f("<ul/>").attr({id:"store-locator-autocomplete-results",class:w.wcshm.admin.vars.maps.storeLocatorAutocompleteResultsClass}),n=f("<img/>").attr({src:a,class:w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.maps.mapMarkerIconClass)});t.insertAfter(c).append(m).append(l),e.insertAfter(t).prepend(n),L.cedarmaps.accessToken=w.wcshm.admin.vars.common.info.alopeyk.wcshm.map.api_key;var s={zoom:w.wcshm.admin.vars.maps.defaultZoom,maxZoom:w.wcshm.admin.vars.maps.maxZoom,center:[r.val().length?parseFloat(r.val()):w.wcshm.admin.vars.maps.defaultCenter.lat,i.val().length?parseFloat(i.val()):w.wcshm.admin.vars.maps.defaultCenter.lng],zoomControl:!1,gestureHandling:!0,gestureHandlingText:{touch:w.wcshm.admin.fn.translate("Use two fingers to move the map"),scroll:w.wcshm.admin.fn.translate("Use ctrl + scroll to zoom the map"),scrollMac:w.wcshm.admin.fn.translate("Use âŒ˜ + scroll to zoom the map")}},p=L.cedarmaps.map(e.get(0),w.wcshm.admin.vars.maps.cedarMapTilesSource.replace("{{TOKEN}}",L.cedarmaps.accessToken),s),h=function(a){var e=l.children(),t=a==e.length?0:a<0?e.length-1:a,n=w.wcshm.admin.vars.common.activeClass;e.removeClass(n).eq(t).addClass(n)},u=function(){w.wcshm.admin.vars.maps.fetchAddressConnection&&w.wcshm.admin.vars.maps.fetchAddressConnection.abort(),c.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return!f(this).is(":disabled")}).prop("disabled",!0).data("alopeyk-disable",!0),t.addClass(w.wcshm.admin.vars.common.loadingClass),w.wcshm.admin.vars.maps.fetchAddressConnection=f.post(w.wcshm.admin.vars.common.info.ajaxOptions.url,{nonce:w.wcshm.admin.vars.common.info.ajaxOptions.nonce,action:w.wcshm.admin.vars.common.info.alopeyk.wcshm.id,request:"get_address",authenticate:!0,ask_cedar:!1,lat:p.getCenter().lat,lng:p.getCenter().lng},function(a){a&&(l.empty(),d.val(a.success&&a.data.city?a.data.city:""),m.val(a.data.address),c.val(a.success?a.data.address:""),a.success?c.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return f(this).data("alopeyk-disable")}).prop("disabled",!1):(r.val(""),i.val("")))}).always(function(){t.removeClass(w.wcshm.admin.vars.common.loadingClass)})};L.control.zoom({position:"bottomright"}).addTo(p),p.on("move",function(){r.val(p.getCenter().lat),i.val(p.getCenter().lng)}),p.on("dragend",function(){u()}),f.merge(r,i).on("change paste keyup input propertychange",function(){w.wcshm.admin.vars.maps.latitudeValue==r.val()&&w.wcshm.admin.vars.maps.longitudeValue==i.val()||(w.wcshm.admin.vars.maps.latitudeValue=r.val(),w.wcshm.admin.vars.maps.longitudeValue=i.val(),w.wcshm.admin.vars.maps.positionKeyupTimeout&&clearTimeout(w.wcshm.admin.vars.maps.positionKeyupTimeout),w.wcshm.admin.vars.maps.positionKeyupTimeout=setTimeout(function(){var a={lat:parseFloat(r.val()),lng:parseFloat(i.val())};p.setView(a),u()},w.wcshm.admin.vars.maps.positionKeyupDelay))}),m.on({keydown:function(a){var e=l.children("."+w.wcshm.admin.vars.common.activeClass),t=e.length?e.index():-1;switch(a.which){case 13:a.preventDefault(),e&&e.trigger("click");break;case 27:m.blur();break;case 38:a.preventDefault(),h(t-1);break;case 40:a.preventDefault(),h(t+1)}},"change paste keyup input propertychange":function(a){w.wcshm.admin.vars.maps.autocompleteInputValue!=m.val()&&(l.empty(),w.wcshm.admin.vars.maps.autocompleteInputValue=m.val(),w.wcshm.admin.vars.maps.autocompleteKeyupTimeout&&clearTimeout(w.wcshm.admin.vars.maps.autocompleteKeyupTimeout),w.wcshm.admin.vars.maps.autocompleteKeyupTimeout=setTimeout(function(){w.wcshm.admin.vars.maps.autocompleteConnection&&w.wcshm.admin.vars.maps.autocompleteConnection.abort(),t.addClass(w.wcshm.admin.vars.common.loadingClass),w.wcshm.admin.vars.maps.autocompleteConnection=f.post(w.wcshm.admin.vars.common.info.ajaxOptions.url,{nonce:w.wcshm.admin.vars.common.info.ajaxOptions.nonce,action:w.wcshm.admin.vars.common.info.alopeyk.wcshm.id,request:"suggest_address",authenticate:!0,ask_cedar:!1,input:m.val(),lat:p.getCenter().lat,lng:p.getCenter().lng},function(a){if(a&&a.success&&a.data.length){m.focus();for(var e=0;e<a.data.length;e++){var t={lat:parseFloat(a.data[e].lat),lng:parseFloat(a.data[e].lng)},n=a.data[e].address,s=a.data[e].city,o=f("<li>").addClass(w.wcshm.admin.vars.maps.storeLocatorAutocompleteResultClass).attr("title",n).data({city:s,address:n,location:t}).text(n).on({click:function(){var a=f(this).data("city"),e=f(this).data("address"),t=f(this).data("location");m.blur(),m.val(e),c.val(e),d.val(a),p.setView(t),p.setZoom(w.wcshm.admin.vars.maps.defaultZoom),r.val(t.lat),i.val(t.lng),w.wcshm.admin.vars.maps.autocompleteInputValue=e,u()},hover:function(){h(f(this).index())}});l.append(o)}}}).always(function(){t.removeClass(w.wcshm.admin.vars.common.loadingClass)})},w.wcshm.admin.vars.maps.autoCompleteKeyupDelay))}})},handleSettingFields:function(){var a=w.wcshm.admin.vars.common.info.alopeyk.wcshm.id+"_",e=f("[id$='"+a+w.wcshm.admin.vars.cost.costTypeInputName+"']"),t=f("[id$='"+a+w.wcshm.admin.vars.cost.staticCostTypeInputName+"']"),n=f("[id$='"+a+w.wcshm.admin.vars.cost.fixedCostInputName+"']"),s=f("[id$='"+a+w.wcshm.admin.vars.cost.percentageCostInputName+"']"),o=w.wcshm.admin.vars.common.checkboxToggleTargetDataAttr,r=w.wcshm.admin.vars.common.checkboxToggleIdDataAttr,i=w.wcshm.admin.vars.upload.inputSelector,d=function(){e.val()==w.wcshm.admin.vars.cost.costTypeDynamicVal?(t.parents("tr").css("display","none"),n.parents("tr").css("display","none"),s.parents("tr").css("display","none")):e.val()==w.wcshm.admin.vars.cost.costTypeStaticVal&&(t.parents("tr").css("display",""),t.val()==w.wcshm.admin.vars.cost.staticCostTypeFixedVal?(n.parents("tr").css("display",""),s.parents("tr").css("display","none")):(s.parents("tr").css("display",""),n.parents("tr").css("display","none")))};f.merge(e,t).on("change",d),d(),f("input:checkbox[data-"+o+"]").on("change",function(){var a=f("input:checkbox[data-"+r+'="'+f(this).data(o)+'"]'),e=f("input:checkbox[data-"+r+'="'+a.data(o)+'"]');a.parents("tr").css("display",f(this).prop("checked")?"":"none"),e.length&&e.parents("tr").css("display",f(this).prop("checked")&&a.prop("checked")?"":"none")}).trigger("change"),f(w.wcshm.admin.vars.maps.storeLocatorHiddenableInput).parents("tr").first().css("display","none"),f.each(f(i),function(a,n){var e=(n=f(n)).val(),s={frame:"post",state:"insert",multiple:!1},o=w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.upload.previewContainerClass),r=f("<div>").addClass(w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.upload.assetsContainerClass)),i=f("<div>").addClass(o).appendTo(r),d=f("<span>").addClass(w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.upload.filenameLabelClass)).appendTo(i);f("<button>").attr("type","button").addClass(w.wcshm.admin.vars.upload.uploadButtonClass).html(n.data(w.wcshm.admin.vars.upload.uploadLabelDataAttr)).appendTo(r).on("click",function(a){a.preventDefault();var e=n.data(w.wcshm.admin.vars.upload.uploadOptionsDataAttr);e=f.extend({},s,e||{});var t=wp.media(e);t.on("insert",function(){var a=t.state().get("selection").first().toJSON();n.val(a.url).trigger("change"),d.text(a.filename),i.removeClass().addClass(o).addClass(w.wcshm.admin.vars.upload.previewTypePrefix+a.subtype),-1!=f.inArray(a.subtype,w.wcshm.admin.vars.common.knownImageExtensions)&&i.css("background-image","url("+a.url+")")}).open()}),f("<button>").attr("type","button").addClass(w.wcshm.admin.vars.upload.removeButtonClass).html(n.data(w.wcshm.admin.vars.upload.removeLabelDataAttr)).appendTo(i).on("click",function(a){a.preventDefault(),n.val("").trigger("change"),d.text(""),i.removeClass().addClass(o).css("background-image","")});if(r.insertAfter(n),e.length){var t=e.split("/").pop(),c=e.split(".").pop();d.text(t),i.removeClass().addClass(o).addClass(w.wcshm.admin.vars.upload.previewTypePrefix+c),-1!=f.inArray(c,w.wcshm.admin.vars.common.knownImageExtensions)&&i.css("background-image","url("+e+")")}n.on("change paste keyup input propertychange",function(){var a=!f(this).val().length,e=w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.upload.isEmptyClass),t=w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.upload.isFilledClass);r.removeClass(a?t:e).addClass(a?e:t)}).trigger("change")})},handleBelowHeadingElements:function(){var a=f(w.wcshm.admin.vars.prompts.headingContainer),e=f(w.wcshm.admin.vars.prompts.belowHeadingElements);a.length&&e.insertBefore(a.find(w.wcshm.admin.vars.prompts.headingElement).first())},handleBulkAction:function(){var a=w.wcshm.admin.vars.bulkAction.submitElement;f(a).length&&f(document).on("click",a,function(a){var e=[],t=f(w.wcshm.admin.vars.bulkAction.dropdownElement);if(f.each(t,function(){e.push(f(this).val())}),-1!=f.inArray(w.wcshm.admin.vars.bulkAction.actionValue,e)){a.preventDefault();var n=[];jQuery.each(f(w.wcshm.admin.vars.bulkAction.actionInputs),function(){n.push(f(this).val())}),w.wcshm.admin.fn.createOrderModal(n)}})},showModal:function(a,e,n,s,o,r,i,t){var d={modal:!0,autoOpen:!0,closeOnEscape:!0,draggable:!1,resizable:!1,width:420,minHeight:24,open:function(){var t=f(this);r?t.dialog("option","buttons",o):w.wcshm.admin.vars.activeModalConnection=f.post(w.wcshm.admin.vars.common.info.ajaxOptions.url,{nonce:w.wcshm.admin.vars.common.info.ajaxOptions.nonce,action:w.wcshm.admin.vars.common.info.alopeyk.wcshm.id,request:n,scope:"admin",data:s},function(a){if(a&&a.success)t.data("response",a.extra?a.extra:null).html(a.data).dialog("option","buttons",o),i&&"function"==typeof i&&i(t);else{var e=a?a.data?a.data:a.toString():w.wcshm.admin.fn.translate("Unkown error occurred.");t.html('<div class="error notice"><p>'+e+"</p></div>")}}).fail(function(a){t.html('<div class="error notice"><p><strong>'+w.wcshm.admin.fn.translate("Request failed:")+"</strong> "+w.wcshm.admin.fn.translate(a.statusText)+"</p></div>")})},close:function(){var a=f(this),e=w.wcshm.admin.vars.activeModalConnection;a.dialog("destroy"),e&&e.abort()}};t=f.extend({},d,t||{}),e&&(t.title=e);var c=f("<div>").attr("align","center").append(f("<img>").attr("src",w.wcshm.admin.vars.common.info.alopeyk.wcshm.loader));f("<div>").attr("id",a?w.wcshm.admin.fn.addPrefix("modal-"+a):null).addClass(w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.common.modalContentClass)).html(r||c).dialog(t)},createOrderModal:function(a,e,t){var n=[{text:w.wcshm.admin.fn.translate("Cancel"),click:function(){f(this).dialog("destroy")}},{text:w.wcshm.admin.fn.translate("Ship"),class:"button-primary",click:function(){f(this).find('[type="submit"]').trigger("click")}}],s={type:e,orders:a,description:t};w.wcshm.admin.fn.showModal("create-order",w.wcshm.admin.fn.translate("Ship via Alopeyk"),"create_order_modal",s,n,null,function(){w.wcshm.admin.fn.handleDateTimeFilters()})},createCreditModal:function(a){var e=[{text:w.wcshm.admin.fn.translate("Cancel"),click:function(){f(this).dialog("destroy")}},{text:w.wcshm.admin.fn.translate("Add Coupon"),click:function(){w.wcshm.admin.fn.createCouponModal()}},{text:w.wcshm.admin.fn.translate("Pay"),class:"button-primary",click:function(){if(f(this).find('[type="submit"]').trigger("click").parents("form").get(0).checkValidity()){f(this).dialog("destroy");var a=f("#"+w.wcshm.admin.fn.addPrefix("modal-check-order"));a.length&&a.dialog("destroy")}}}],t={amount:a};w.wcshm.admin.fn.showModal("create-credit",w.wcshm.admin.fn.translate("Add Alopeyk Credit"),"create_credit_modal",t,e,null)},createCouponModal:function(){var a=[{text:w.wcshm.admin.fn.translate("Cancel"),click:function(){f(this).dialog("destroy")}},{text:w.wcshm.admin.fn.translate("Apply"),class:"button-primary",click:function(){f(this).find('[type="submit"]').trigger("click")}}];w.wcshm.admin.fn.showModal("create-coupon",w.wcshm.admin.fn.translate("Add Alopeyk Coupon"),"create_coupon_modal",null,a,null)},createCancelModal:function(a){var e=[{text:w.wcshm.admin.fn.translate("Close"),click:function(){f(this).dialog("destroy")}},{text:w.wcshm.admin.fn.translate("Cancel"),class:"button-primary",click:function(){f(this).find('[type="submit"]').trigger("click")}}],t={order:a};w.wcshm.admin.fn.showModal("cancel-order",w.wcshm.admin.fn.translate("Cancel Alopeyk Order"),"create_cancel_modal",t,e,null)},createRateModal:function(a){var e=[{text:w.wcshm.admin.fn.translate("Close"),click:function(){f(this).dialog("destroy")}},{text:w.wcshm.admin.fn.translate("Submit"),class:"button-primary",click:function(){f(this).find('[type="submit"]').trigger("click")}}],t={order:a};w.wcshm.admin.fn.showModal("rate-order",w.wcshm.admin.fn.translate("Rate Alopeyk Courier"),"create_rate_modal",t,e,null,function(a){a.find('input[type="radio"]').on("change",function(){a.dialog("option","position",{of:window,my:"center",at:"center"})})})},handleDateTimeFilters:function(){var r=0,i=0,a=w.wcshm.admin.vars.common.info.alopeyk.wcshm.scope.schedule_dates.dates,d=w.wcshm.admin.vars.common.info.alopeyk.wcshm.scope.schedule_dates.steps,c=f(w.wcshm.admin.vars.forms.dateDropdownElement).filter(function(){return!f(this).data("alopeyk-initiated")}).data("alopeyk-initiated",!0),s=f(w.wcshm.admin.vars.forms.hourDropdownElement).filter(function(){return!f(this).data("alopeyk-initiated")}).data("alopeyk-initiated",!0),m=f(w.wcshm.admin.vars.forms.minuteDropdownElement).filter(function(){return!f(this).data("alopeyk-initiated")}).data("alopeyk-initiated",!0);if(c.length&&s.length&&m.length&&a&&Object.keys(a).length){for(var e in c.children().remove().end().on("change",function(){s.children().remove();for(var a=f(this).find(":selected"),e=parseInt(a.data("initial_hour")),t=(parseInt(a.data("initial_minute")),e);t<24;t++){var n=w.wcshm.admin.fn.pad(t,2,"0");f("<option>").attr("value",n).attr("selected",r==t).text(n).appendTo(s)}s.trigger("change")}),d=Math.max(1,parseInt(d)),s.children().remove().end().on("change",function(){m.children().remove();for(var a=c.find(":selected"),e=parseInt(a.data("initial_hour")),t=parseInt(f(this).find(":selected").val()),n=parseInt(a.data("initial_minute")),s=e==(r=t)?n:0;s<60;s+=d){var o=w.wcshm.admin.fn.pad(s,2,"0");f("<option>").attr("value",o).attr("selected",s==i).text(o).appendTo(m)}m.trigger("change")}),m.children().remove().end().on("change",function(){i=parseInt(f(this).find(":selected").val())}),a)a.hasOwnProperty(e)&&f("<option>").attr("value",e).text(a[e].label).appendTo(c).data("initial_hour",a[e].initial_hour).data("initial_minute",a[e].initial_minute);c.trigger("change"),s.trigger("change")}},pad:function(a,e,t){return t=t||"0",(a+="").length>=e?a:new Array(e-a.length+1).join(t)+a},handleCheckOrderForm:function(){f(document).on("submit","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.forms.createOrderFormClass),function(a){a.preventDefault();var e=[{text:w.wcshm.admin.fn.translate("Cancel"),click:function(){f(this).dialog("destroy")}},{text:w.wcshm.admin.fn.translate("Submit"),class:"button-primary",click:function(){var a=[{text:w.wcshm.admin.fn.translate("Track Order"),click:function(){var a=w.wcshm.admin.fn.decodeToHtml(f(this).data("response").tracking_url);w.wcshm.admin.fn.openTab(a)}},{text:w.wcshm.admin.fn.translate("View Order"),class:"button-primary",click:function(){var a=w.wcshm.admin.fn.decodeToHtml(f(this).data("response").edit_url);w.wcshm.admin.fn.openTab(a)}}],e=f(this);e.dialog("destroy"),w.wcshm.admin.fn.showModal("submit-order",w.wcshm.admin.fn.translate("Alopeyk Order"),"submit_order_modal",e.data("response"),a,null,function(){var a=f("#"+w.wcshm.admin.fn.addPrefix("modal-create-order"));a.length&&a.dialog("destroy"),f(document).trigger("awcshm:order:create")})}}],t=f(this),n=t.serialize(),s=w.wcshm.admin.fn.getUrlVars("#?"+n);if("false"==s.ship_now&&s.ship_date&&s.ship_date.length&&s.ship_hour&&s.ship_hour.length&&s.ship_minute&&s.ship_minute.length&&w.wcshm.admin.vars.common.time&&w.wcshm.admin.vars.common.info.time){var o=new Date(parseInt((""+w.wcshm.admin.vars.common.info.time).replace(/-/g,"/")))-new Date(parseInt((""+w.wcshm.admin.vars.common.time).replace(/-/g,"/")));if(new Date(s.ship_date+" "+s.ship_hour+":"+s.ship_minute+":00").getTime()+o>Date.now())w.wcshm.admin.fn.showModal("check-order",w.wcshm.admin.fn.translate("Alopeyk Order"),"check_order_modal",n,e);else{var r=[{text:w.wcshm.admin.fn.translate("No"),click:function(){f(this).dialog("destroy")}},{text:w.wcshm.admin.fn.translate("Yes"),class:"button-primary",click:function(){f(w.wcshm.admin.vars.forms.shipNowTogglerElement).val(["true"]),n=t.serialize(),f(this).dialog("destroy"),w.wcshm.admin.fn.showModal("check-order",w.wcshm.admin.fn.translate("Alopeyk Order"),"check_order_modal",n,e)}}];w.wcshm.admin.fn.showModal("check-order-time",w.wcshm.admin.fn.translate("Alopeyk Order"),null,null,r,w.wcshm.admin.vars.common.info.alopeyk.wcshm.scope.schedule_dates.error)}}else w.wcshm.admin.fn.showModal("check-order",w.wcshm.admin.fn.translate("Alopeyk Order"),"check_order_modal",n,e)})},handleAddCouponForm:function(){f(document).on("submit","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.forms.addCouponFormClass),function(a){a.preventDefault();var e=f(this).serialize();w.wcshm.admin.fn.showModal("add-coupon",w.wcshm.admin.fn.translate("Alopeyk Coupon"),"add_coupon_modal",e,null,null,function(){var a=f("#"+w.wcshm.admin.fn.addPrefix("modal-create-coupon")),e=f("#"+w.wcshm.admin.fn.addPrefix("modal-create-credit")),t=f("#"+w.wcshm.admin.fn.addPrefix("modal-check-order"));a.length&&a.dialog("destroy"),e.length&&e.dialog("destroy"),t.length&&t.dialog("destroy"),f(document).trigger("awcshm:credit:add")})})},handleCancelOrderForm:function(){f(document).on("submit","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.forms.cancelOrderFormClass),function(a){a.preventDefault();var e=f(this).serialize();w.wcshm.admin.fn.showModal("cancel-order-result",w.wcshm.admin.fn.translate("Cancel Order"),"cancel_result_modal",e,null,null,function(){var a=f("#"+w.wcshm.admin.fn.addPrefix("modal-cancel-order"));a.length&&a.dialog("destroy"),f(document).trigger("awcshm:order:cancel")})})},handleRateOrderForm:function(){f(document).on("submit","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.forms.rateOrderFormClass),function(a){a.preventDefault();var e=f(this).serialize();w.wcshm.admin.fn.showModal("rate-order-result",w.wcshm.admin.fn.translate("Rate Alopeyk Courier"),"rate_result_modal",e,null,null,function(){var a=f("#"+w.wcshm.admin.fn.addPrefix("modal-rate-order"));a.length&&a.dialog("destroy"),f(document).trigger("awcshm:order:finish")})})},setupCreditModalTrigger:function(){f(document).on("click","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.modals.creditModalTogglerClass),function(a){a.preventDefault();var e=f(this).data(w.wcshm.admin.vars.modals.creditModalAmountDataAttr);w.wcshm.admin.fn.createCreditModal(e)})},setupOrderModalTrigger:function(){f(document).on("click","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.modals.orderModalTogglerClass),function(a){a.preventDefault();var e=f(this),t=e.data(w.wcshm.admin.vars.modals.orderModalTypeDataAttr),n=e.data(w.wcshm.admin.vars.modals.orderModalOrdersDataAttr),s=e.data(w.wcshm.admin.vars.modals.orderModalDescriptionDataAttr);n=(n=void 0!==n?n+"":null)&&n.length?n.split(w.wcshm.admin.vars.modals.orderModalOrdersDelimiter):null,w.wcshm.admin.fn.createOrderModal(n,t,s)})},setupCouponModalTrigger:function(){f(document).on("click","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.modals.couponModalTogglerClass),function(a){a.preventDefault(),w.wcshm.admin.fn.createCouponModal()})},setupCancelModalTrigger:function(){f(document).on("click","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.modals.cancelModalTogglerClass),function(a){a.preventDefault(),w.wcshm.admin.fn.createCancelModal(f(this).data(w.wcshm.admin.vars.modals.cancelModalOrderDataAttr))})},setupRateModalTrigger:function(){f(document).on("click","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.modals.rateModalTogglerClass),function(a){a.preventDefault(),w.wcshm.admin.fn.createRateModal(f(this).data(w.wcshm.admin.vars.modals.rateModalOrderDataAttr))})},handleAmountButtons:function(){f(document).on("click","."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.forms.creditButtonElementClass),function(){var a=f(this),e=a.data(w.wcshm.admin.vars.forms.creditButtonAmountDataAttr),t=f(a.data(w.wcshm.admin.vars.forms.creditButtonTargetDataAttr));(t=t&&t.length?t:f("."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.forms.priceInputsClass))).length&&t.val(e||"")})},handlePriceInputs:function(){var a="."+w.wcshm.admin.fn.addPrefix(w.wcshm.admin.vars.forms.priceInputsClass);f(document).on("keydown",a,function(a){-1!==f.inArray(a.keyCode,[46,8,9,27,13,110,190])||/65|67|86|88/.test(a.keyCode)&&(!0===a.ctrlKey||!0===a.metaKey)&&(!0===a.ctrlKey||!0===a.metaKey)||35<=a.keyCode&&a.keyCode<=40||(a.shiftKey||a.keyCode<48||57<a.keyCode)&&(a.keyCode<96||105<a.keyCode)&&a.preventDefault()}),f(document).on("change paste keyup input propertychange",a,function(a){var e=f(this),t=e.val();e.val(t.replace(/\D/g,""))}).trigger("change")},handlePageUpdates:function(){var t=[],a=parseInt(w.wcshm.admin.vars.common.info.refresh_interval),e=w.wcshm.admin.vars.common.info.dynamic_parts;if(e&&e.length&&(f.each(e,function(a,e){f(e).length&&t.push(e)}),t.length)){var n=function(){w.wcshm.admin.vars.common.pageUpdateConnection&&w.wcshm.admin.vars.common.pageUpdateConnection.abort(),w.wcshm.admin.vars.common.pageUpdateConnection=f.ajax(window.location.href).done(function(a){var s=f(a);f.each(t,function(a,e){var t=f(e),n=s.find(e).html();t.html()!=n&&t.html(n)})})};setInterval(n,1e3*(a||10));f(document).on("awcshm:order:create awcshm:order:cancel awcshm:order:finish awcshm:credit:add",n)}},handleChatToggler:function(){f(document).on("change",w.wcshm.admin.vars.chat.togglerInput,function(){if(f(this).prop("checked")){var a=f(document).height()>f(window).height();f("html, body").stop().animate({scrollTop:0},250,function(){f("body").scrollTop(0).css("overflow","hidden").parent().css("overflow-y",a?"scroll":"")})}else f("body").css("overflow","").parent().css("overflow-y","")}),f(w.wcshm.admin.vars.chat.togglerInput).trigger("change")},init:function(){w.wcshm.admin.fn.handlePageUpdates(),w.wcshm.admin.fn.handleChatToggler(),w.wcshm.admin.fn.handlePriceInputs(),w.wcshm.admin.fn.handleAmountButtons(),w.wcshm.admin.fn.handleSettingFields(),w.wcshm.admin.fn.handleBulkAction(),w.wcshm.admin.fn.handleDateTimeFilters(),w.wcshm.admin.fn.handleCheckOrderForm(),w.wcshm.admin.fn.handleCancelOrderForm(),w.wcshm.admin.fn.handleRateOrderForm(),w.wcshm.admin.fn.handleAddCouponForm(),w.wcshm.admin.fn.setupCreditModalTrigger(),w.wcshm.admin.fn.setupOrderModalTrigger(),w.wcshm.admin.fn.setupCancelModalTrigger(),w.wcshm.admin.fn.setupCouponModalTrigger(),w.wcshm.admin.fn.setupRateModalTrigger(),w.wcshm.admin.fn.handleBelowHeadingElements()}},f(document).on({ready:function(a){w.wcshm.admin.fn.init()}}),f(window).on({load:function(a){w.wcshm.admin.fn.initMaps()}})}(jQuery);