!function(a){"use strict";var e=e||{wcshm:{}};e.wcshm.admin={},e.wcshm.admin.vars={common:{info:window.awcshm,time:Date.now(),activeClass:"active",loadingClass:"loading",disabledClass:"disabled",alopeykPrefix:"awcshm-",checkboxToggleIdDataAttr:"checkbox-toggle-id",checkboxToggleTargetDataAttr:"checkbox-toggle-target",knownImageExtensions:["jpg","jpeg","gif","tiff","png","apng","bmp","svg"],modalContentClass:"modal-content"},maps:{selector:".map-canvas",storeLatInputName:"store_lat",storeLngInputName:"store_lng",storeCityInputName:"store_city",storeAddressInputName:"store_address",storeLocatorMapClass:"map-canvas store-locator-map",storeLocatorInputWrapperClass:"store-locator-input-wrapper",storeLocatorAutocompleteResultsClass:"store-locator-autocomplete-results",storeLocatorAutocompleteResultClass:"store-locator-autocomplete-result",storeLocatorHiddenableInput:".hide-parent-row",autocompletePlaceholderDataAttr:"autocomplete-placeholder",autocompleteKeyupTimeout:null,positionKeyupTimeout:null,autoCompleteKeyupDelay:500,positionKeyupDelay:500,defaultZoom:15,defaultCenter:{lat:35.732466,lng:51.413811}},cost:{costTypeInputName:"cost_type",staticCostTypeInputName:"static_cost_type",fixedCostInputName:"static_cost_fixed",percentageCostInputName:"static_cost_percentage",costTypeDynamicVal:"dynamic",costTypeStaticVal:"static",staticCostTypeFixedVal:"fixed",staticCostTypePercentageVal:"percentage"},upload:{inputSelector:".input-upload",assetsContainerClass:"upload-assets-container",previewContainerClass:"preview-container",previewTypePrefix:"preview-type-",uploadButtonClass:"button-primary upload-button",removeButtonClass:"button button-small remove-button",filenameLabelClass:"filename-label",uploadLabelDataAttr:"upload-label",removeLabelDataAttr:"remove-label",uploadOptionsDataAttr:"upload-options",isEmptyClass:"is-empty",isFilledClass:"is-filled"},prompts:{headingElement:"h2",headingContainer:"#mainform",belowHeadingElements:".below-heading"},bulkAction:{actionValue:"alopeyk_cumulative_shipping",formElement:".post-type-shop_order #posts-filter",submitElement:"#doaction, #doaction2",actionInputs:'[name="post[]"]:checked',dropdownElement:"#bulk-action-selector-bottom, #bulk-action-selector-top"},forms:{priceInputsClass:"price-input",dateDropdownElement:'[name="ship_date"]',hourDropdownElement:'[name="ship_hour"]',minuteDropdownElement:'[name="ship_minute"]',shipNowTogglerElement:'[name="ship_now"]',createOrderFormClass:"create-order-form",creditButtonElementClass:"amount-button",creditButtonAmountDataAttr:"credit-amount",creditButtonTargetDataAttr:"credit-target",addCouponFormClass:"add-coupon-form",cancelOrderFormClass:"cancel-order-form",rateOrderFormClass:"rate-order-form"},modals:{creditModalTogglerClass:"credit-modal-toggler",creditModalAmountDataAttr:"credit-amount",orderModalTogglerClass:"order-modal-toggler",orderModalTypeDataAttr:"order-types",orderModalOrdersDataAttr:"order-ids",orderModalDescriptionDataAttr:"order-description",orderModalOrdersDelimiter:",",couponModalTogglerClass:"coupon-modal-toggler",cancelModalTogglerClass:"cancel-modal-toggler",cancelModalOrderDataAttr:"order-id",rateModalTogglerClass:"rate-modal-toggler",rateModalOrderDataAttr:"order-id"},chat:{togglerInput:"#awcshm-support-chat-toggler"}},e.wcshm.admin.fn={addPrefix:function(a){for(var t=[],n=a.split(" "),o=0;o<n.length;o++)t.push(e.wcshm.admin.vars.common.alopeykPrefix+n[o]);return t.join(" ")},translate:function(a){var t=e.wcshm.admin.vars.common.info.translations[a];return t||a},getUrlVars:function(a){for(var e=[],t=(a=a||window.location.href).indexOf("?"),n=-1!=t?decodeURIComponent(a).slice(t+1):null,o=(e=n?n.split("&"):[],[]),s=0;s<e.length;s++){var r=e[s].split("=");if(r[0]=r[0].replace("[]",""),void 0===r[1]&&(r[1]=""),void 0===o[r[0]])o[r[0]]=r[1];else if("string"==typeof o[r[0]]){var i=[o[r[0]],r[1]];o[r[0]]=i}else o[r[0]].push(r[1])}return"object"==typeof o?o:null},openTab:function(t){var n=a("<form>"),o=e.wcshm.admin.fn.getUrlVars(t);if(o&&Object.keys(o).length)for(var s in o)o.hasOwnProperty(s)&&n.append(a("<input>").attr({type:"hidden",name:s,value:o[s]}));n.attr({action:t,method:"GET",target:"_blank"}).appendTo("body").trigger("submit").remove()},decodeToHtml:function(a){var e=document.createElement("textarea");return e.innerHTML=a,e.value},injectScript:function(e){var t,n;a('[src="'+e+'"]').length||((t=document.createElement("script")).type="text/javascript",t.async=!0,t.src=e,(n=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,n))},loadGoogleMaps:function(){window.alopeykHandleMapsAdmin=e.wcshm.admin.fn.handleMaps,"function"==typeof alopeykHandleMapsAdmin&&(void 0!==window.google&&window.google.maps?(window.googleMapIsLoading=!1,e.wcshm.admin.fn.handleMaps()):window.googleMapIsLoading?e.wcshm.admin.vars.loadingMapInterval=setInterval(function(){window.google&&window.google.maps&&(window.googleMapIsLoading=!1,clearInterval(e.wcshm.admin.vars.loadingMapInterval),e.wcshm.admin.fn.handleMaps())},500):(window.googleMapIsLoading=!0,e.wcshm.admin.fn.injectScript("https://maps.googleapis.com/maps/api/js?key="+e.wcshm.admin.vars.common.info.alopeyk.wcshm.map.api_key+"&language=fa&region=IR&callback=alopeykHandleMapsAdmin")))},handleMaps:function(){a(document).trigger("alopeyk:admin:map:loaded")},initMaps:function(){a(document).on("alopeyk:admin:map:loaded",function(){var t=e.wcshm.admin.vars.common.info.alopeyk.wcshm.id+"_",n=a("[id$='"+t+e.wcshm.admin.vars.maps.storeLatInputName+"']"),o=a("[id$='"+t+e.wcshm.admin.vars.maps.storeLngInputName+"']"),s=a("[id$='"+t+e.wcshm.admin.vars.maps.storeCityInputName+"']"),r=a("[id$='"+t+e.wcshm.admin.vars.maps.storeAddressInputName+"']");n.length&&o.length&&s.length&&r.length&&e.wcshm.admin.fn.initStoreLocator(n.first(),o.first(),s.first(),r.first())}),e.wcshm.admin.fn.loadGoogleMaps()},initStoreLocator:function(t,n,o,s){var r=a("<div/>").attr({id:"store-locator-map",class:e.wcshm.admin.vars.maps.storeLocatorMapClass}),i=s.clone().attr({id:s.attr("id")+"_autocomplete",class:s.attr("class"),placeholder:s.data(e.wcshm.admin.vars.maps.autocompletePlaceholderDataAttr),name:"",style:"",value:"",type:"text",spellcheck:"false",autocapitalize:"off",autocorrect:"off",autocomplete:"off"}).removeClass(e.wcshm.admin.vars.common.disabledClass),d=a("<div>").attr({id:"store-locator-input-wrapper",class:e.wcshm.admin.vars.maps.storeLocatorInputWrapperClass}),c=a("<ul>").attr({id:"store-locator-autocomplete-results",class:e.wcshm.admin.vars.maps.storeLocatorAutocompleteResultsClass});d.insertAfter(s).append(i).append(c),r.insertAfter(d);var m={zoom:e.wcshm.admin.vars.maps.defaultZoom,center:{lat:t.val().length?parseFloat(t.val()):e.wcshm.admin.vars.maps.defaultCenter.lat,lng:n.val().length?parseFloat(n.val()):e.wcshm.admin.vars.maps.defaultCenter.lng},mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1},l=new google.maps.Map(r.get(0),m),p=new google.maps.Marker({map:l,draggable:!0,position:m.center,anchorPoint:new google.maps.Point(0,-29)}),h=function(a){var t=c.children(),n=a==t.length?0:a<0?t.length-1:a,o=e.wcshm.admin.vars.common.activeClass;t.removeClass(o).eq(n).addClass(o)},u=function(){e.wcshm.admin.vars.maps.fetchAddressConnection&&e.wcshm.admin.vars.maps.fetchAddressConnection.abort(),s.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return!a(this).is(":disabled")}).prop("disabled",!0).data("alopeyk-disable",!0),d.addClass(e.wcshm.admin.vars.common.loadingClass),e.wcshm.admin.vars.maps.fetchAddressConnection=a.post(e.wcshm.admin.vars.common.info.ajaxOptions.url,{nonce:e.wcshm.admin.vars.common.info.ajaxOptions.nonce,action:e.wcshm.admin.vars.common.info.alopeyk.wcshm.id,request:"get_address",authenticate:!0,ask_google:!1,lat:p.getPosition().lat(),lng:p.getPosition().lng()},function(e){e&&(c.empty(),o.val(e.success&&e.data.city?e.data.city:""),i.val(e.data.address),s.val(e.success?e.data.address:""),e.success?s.parents("form").find('button, input[type="button"], input[type="submit"]').filter(function(){return a(this).data("alopeyk-disable")}).prop("disabled",!1):(t.val(""),n.val("")))}).always(function(){d.removeClass(e.wcshm.admin.vars.common.loadingClass)})};p.addListener("drag",function(){t.val(p.getPosition().lat()),n.val(p.getPosition().lng())}),p.addListener("dragend",function(){u()}),a.merge(t,n).on("change paste keyup input propertychange",function(){e.wcshm.admin.vars.maps.latitudeValue==t.val()&&e.wcshm.admin.vars.maps.longitudeValue==n.val()||(e.wcshm.admin.vars.maps.latitudeValue=t.val(),e.wcshm.admin.vars.maps.longitudeValue=n.val(),e.wcshm.admin.vars.maps.positionKeyupTimeout&&clearTimeout(e.wcshm.admin.vars.maps.positionKeyupTimeout),e.wcshm.admin.vars.maps.positionKeyupTimeout=setTimeout(function(){var a={lat:parseFloat(t.val()),lng:parseFloat(n.val())};l.setCenter(a),p.setPosition(a),u()},e.wcshm.admin.vars.maps.positionKeyupDelay))}),i.on({keydown:function(a){var t=c.children("."+e.wcshm.admin.vars.common.activeClass),n=t.length?t.index():-1;switch(a.which){case 13:a.preventDefault(),t&&t.trigger("click");break;case 27:i.blur();break;case 38:a.preventDefault(),h(n-1);break;case 40:a.preventDefault(),h(n+1)}},"change paste keyup input propertychange":function(r){e.wcshm.admin.vars.maps.autocompleteInputValue!=i.val()&&(c.empty(),e.wcshm.admin.vars.maps.autocompleteInputValue=i.val(),e.wcshm.admin.vars.maps.autocompleteKeyupTimeout&&clearTimeout(e.wcshm.admin.vars.maps.autocompleteKeyupTimeout),e.wcshm.admin.vars.maps.autocompleteKeyupTimeout=setTimeout(function(){e.wcshm.admin.vars.maps.autocompleteConnection&&e.wcshm.admin.vars.maps.autocompleteConnection.abort(),d.addClass(e.wcshm.admin.vars.common.loadingClass),e.wcshm.admin.vars.maps.autocompleteConnection=a.post(e.wcshm.admin.vars.common.info.ajaxOptions.url,{nonce:e.wcshm.admin.vars.common.info.ajaxOptions.nonce,action:e.wcshm.admin.vars.common.info.alopeyk.wcshm.id,request:"suggest_address",authenticate:!0,ask_google:!1,input:i.val()},function(r){if(r&&r.success&&r.data.length)for(var d=0;d<r.data.length;d++){var m={lat:parseFloat(r.data[d].lat),lng:parseFloat(r.data[d].lng)},f=r.data[d].address,w=r.data[d].city,g=a("<li>").addClass(e.wcshm.admin.vars.maps.storeLocatorAutocompleteResultClass).attr("title",f).data({city:w,address:f,location:m}).text(f).on({click:function(){var r=a(this).data("city"),d=a(this).data("address"),c=a(this).data("location");i.blur(),i.val(d),s.val(d),o.val(r),l.setCenter(c),l.setZoom(17),p.setPosition(c),p.setVisible(!0),t.val(c.lat),n.val(c.lng),e.wcshm.admin.vars.maps.autocompleteInputValue=d,u()},hover:function(){h(a(this).index())}});c.append(g)}}).always(function(){d.removeClass(e.wcshm.admin.vars.common.loadingClass)})},e.wcshm.admin.vars.maps.autoCompleteKeyupDelay))}}),google.maps.event.addListenerOnce(l,"idle",function(){d.css({zIndex:2,position:"absolute"})}),google.maps.event.addDomListener(window,"resize",function(){e.wcshm.admin.vars.maps.centerTimeout&&clearTimeout(e.wcshm.admin.vars.maps.centerTimeout),e.wcshm.admin.vars.maps.centerTimeout=setTimeout(function(){l.setCenter(p.getPosition())},100)})},handleSettingFields:function(){var t=e.wcshm.admin.vars.common.info.alopeyk.wcshm.id+"_",n=a("[id$='"+t+e.wcshm.admin.vars.cost.costTypeInputName+"']"),o=a("[id$='"+t+e.wcshm.admin.vars.cost.staticCostTypeInputName+"']"),s=a("[id$='"+t+e.wcshm.admin.vars.cost.fixedCostInputName+"']"),r=a("[id$='"+t+e.wcshm.admin.vars.cost.percentageCostInputName+"']"),i=e.wcshm.admin.vars.common.checkboxToggleTargetDataAttr,d=e.wcshm.admin.vars.common.checkboxToggleIdDataAttr,c=e.wcshm.admin.vars.upload.inputSelector,m=function(){n.val()==e.wcshm.admin.vars.cost.costTypeDynamicVal?(o.parents("tr").css("display","none"),s.parents("tr").css("display","none"),r.parents("tr").css("display","none")):n.val()==e.wcshm.admin.vars.cost.costTypeStaticVal&&(o.parents("tr").css("display",""),o.val()==e.wcshm.admin.vars.cost.staticCostTypeFixedVal?(s.parents("tr").css("display",""),r.parents("tr").css("display","none")):(r.parents("tr").css("display",""),s.parents("tr").css("display","none")))};a.merge(n,o).on("change",m),m(),a("input:checkbox[data-"+i+"]").on("change",function(){var e=a("input:checkbox[data-"+d+'="'+a(this).data(i)+'"]'),t=a("input:checkbox[data-"+d+'="'+e.data(i)+'"]');e.parents("tr").css("display",a(this).prop("checked")?"":"none"),t.length&&t.parents("tr").css("display",a(this).prop("checked")&&e.prop("checked")?"":"none")}).trigger("change"),a(e.wcshm.admin.vars.maps.storeLocatorHiddenableInput).parents("tr").first().css("display","none"),a.each(a(c),function(t,n){var o=(n=a(n)).val(),s={frame:"post",state:"insert",multiple:!1},r=e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.previewContainerClass),i=a("<div>").addClass(e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.assetsContainerClass)),d=a("<div>").addClass(r).appendTo(i),c=a("<span>").addClass(e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.filenameLabelClass)).appendTo(d);a("<button>").attr("type","button").addClass(e.wcshm.admin.vars.upload.uploadButtonClass).html(n.data(e.wcshm.admin.vars.upload.uploadLabelDataAttr)).appendTo(i).on("click",function(t){t.preventDefault();var o=n.data(e.wcshm.admin.vars.upload.uploadOptionsDataAttr);o=a.extend({},s,o||{});var i=wp.media(o);i.on("insert",function(){var t=i.state().get("selection").first().toJSON();n.val(t.url).trigger("change"),c.text(t.filename),d.removeClass().addClass(r).addClass(e.wcshm.admin.vars.upload.previewTypePrefix+t.subtype),-1!=a.inArray(t.subtype,e.wcshm.admin.vars.common.knownImageExtensions)&&d.css("background-image","url("+t.url+")")}).open()}),a("<button>").attr("type","button").addClass(e.wcshm.admin.vars.upload.removeButtonClass).html(n.data(e.wcshm.admin.vars.upload.removeLabelDataAttr)).appendTo(d).on("click",function(a){a.preventDefault(),n.val("").trigger("change"),c.text(""),d.removeClass().addClass(r).css("background-image","")});if(i.insertAfter(n),o.length){var m=o.split("/").pop(),l=o.split(".").pop();c.text(m),d.removeClass().addClass(r).addClass(e.wcshm.admin.vars.upload.previewTypePrefix+l),-1!=a.inArray(l,e.wcshm.admin.vars.common.knownImageExtensions)&&d.css("background-image","url("+o+")")}n.on("change paste keyup input propertychange",function(){var t=!a(this).val().length,n=e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.isEmptyClass),o=e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.upload.isFilledClass);i.removeClass(t?o:n).addClass(t?n:o)}).trigger("change")})},handleBelowHeadingElements:function(){var t=a(e.wcshm.admin.vars.prompts.headingContainer),n=a(e.wcshm.admin.vars.prompts.belowHeadingElements);t.length&&n.insertBefore(t.find(e.wcshm.admin.vars.prompts.headingElement).first())},handleBulkAction:function(){var t=e.wcshm.admin.vars.bulkAction.submitElement;a(t).length&&a(document).on("click",t,function(t){var n=[],o=a(e.wcshm.admin.vars.bulkAction.dropdownElement);if(a.each(o,function(){n.push(a(this).val())}),-1!=a.inArray(e.wcshm.admin.vars.bulkAction.actionValue,n)){t.preventDefault();var s=[];jQuery.each(a(e.wcshm.admin.vars.bulkAction.actionInputs),function(){s.push(a(this).val())}),e.wcshm.admin.fn.createOrderModal(s)}})},showModal:function(t,n,o,s,r,i,d,c){var m={modal:!0,autoOpen:!0,closeOnEscape:!0,draggable:!1,resizable:!1,width:420,minHeight:24,open:function(){var t=a(this);i?t.dialog("option","buttons",r):e.wcshm.admin.vars.activeModalConnection=a.post(e.wcshm.admin.vars.common.info.ajaxOptions.url,{nonce:e.wcshm.admin.vars.common.info.ajaxOptions.nonce,action:e.wcshm.admin.vars.common.info.alopeyk.wcshm.id,request:o,scope:"admin",data:s},function(a){if(a&&a.success)t.data("response",a.extra?a.extra:null).html(a.data).dialog("option","buttons",r),d&&"function"==typeof d&&d(t);else{var n=a?a.data?a.data:a.toString():e.wcshm.admin.fn.translate("Unkown error occurred.");t.html('<div class="error notice"><p>'+n+"</p></div>")}}).fail(function(a){t.html('<div class="error notice"><p><strong>'+e.wcshm.admin.fn.translate("Request failed:")+"</strong> "+e.wcshm.admin.fn.translate(a.statusText)+"</p></div>")})},close:function(){var t=a(this),n=e.wcshm.admin.vars.activeModalConnection;t.dialog("destroy"),n&&n.abort()}};c=a.extend({},m,c||{}),n&&(c.title=n);var l=a("<div>").attr("align","center").append(a("<img>").attr("src",e.wcshm.admin.vars.common.info.alopeyk.wcshm.loader));a("<div>").attr("id",t?e.wcshm.admin.fn.addPrefix("modal-"+t):null).addClass(e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.common.modalContentClass)).html(i||l).dialog(c)},createOrderModal:function(t,n,o){var s=[{text:e.wcshm.admin.fn.translate("Cancel"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Ship"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}],r={type:n,orders:t,description:o};e.wcshm.admin.fn.showModal("create-order",e.wcshm.admin.fn.translate("Ship via Alopeyk"),"create_order_modal",r,s,null,function(){e.wcshm.admin.fn.handleDateTimeFilters()})},createCreditModal:function(t){var n=[{text:e.wcshm.admin.fn.translate("Cancel"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Add Coupon"),click:function(){e.wcshm.admin.fn.createCouponModal()}},{text:e.wcshm.admin.fn.translate("Pay"),class:"button-primary",click:function(){if(a(this).find('[type="submit"]').trigger("click").parents("form").get(0).checkValidity()){a(this).dialog("destroy");var t=a("#"+e.wcshm.admin.fn.addPrefix("modal-check-order"));t.length&&t.dialog("destroy")}}}],o={amount:t};e.wcshm.admin.fn.showModal("create-credit",e.wcshm.admin.fn.translate("Add Alopeyk Credit"),"create_credit_modal",o,n,null)},createCouponModal:function(){var t=[{text:e.wcshm.admin.fn.translate("Cancel"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Apply"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}];e.wcshm.admin.fn.showModal("create-coupon",e.wcshm.admin.fn.translate("Add Alopeyk Coupon"),"create_coupon_modal",null,t,null)},createCancelModal:function(t){var n=[{text:e.wcshm.admin.fn.translate("Close"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Cancel"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}],o={order:t};e.wcshm.admin.fn.showModal("cancel-order",e.wcshm.admin.fn.translate("Cancel Alopeyk Order"),"create_cancel_modal",o,n,null)},createRateModal:function(t){var n=[{text:e.wcshm.admin.fn.translate("Close"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Submit"),class:"button-primary",click:function(){a(this).find('[type="submit"]').trigger("click")}}],o={order:t};e.wcshm.admin.fn.showModal("rate-order",e.wcshm.admin.fn.translate("Rate Alopeyk Courier"),"create_rate_modal",o,n,null,function(a){a.find('input[type="radio"]').on("change",function(){a.dialog("option","position",{of:window,my:"center",at:"center"})})})},handleDateTimeFilters:function(){var t=0,n=0,o=e.wcshm.admin.vars.common.info.alopeyk.wcshm.scope.schedule_dates.dates,s=e.wcshm.admin.vars.common.info.alopeyk.wcshm.scope.schedule_dates.steps,r=a(e.wcshm.admin.vars.forms.dateDropdownElement).filter(function(){return!a(this).data("alopeyk-initiated")}).data("alopeyk-initiated",!0),i=a(e.wcshm.admin.vars.forms.hourDropdownElement).filter(function(){return!a(this).data("alopeyk-initiated")}).data("alopeyk-initiated",!0),d=a(e.wcshm.admin.vars.forms.minuteDropdownElement).filter(function(){return!a(this).data("alopeyk-initiated")}).data("alopeyk-initiated",!0);if(r.length&&i.length&&d.length&&o&&Object.keys(o).length){for(var c in r.children().remove().end().on("change",function(){i.children().remove();for(var n=a(this).find(":selected"),o=parseInt(n.data("initial_hour")),s=(parseInt(n.data("initial_minute")),o);s<24;s++){var r=e.wcshm.admin.fn.pad(s,2,"0");a("<option>").attr("value",r).attr("selected",t==s).text(r).appendTo(i)}i.trigger("change")}),s=Math.max(1,parseInt(s)),i.children().remove().end().on("change",function(){d.children().remove();var o=r.find(":selected"),i=parseInt(o.data("initial_hour")),c=parseInt(a(this).find(":selected").val()),m=parseInt(o.data("initial_minute"));t=c;for(var l=i==c?m:0;l<60;l+=s){var p=e.wcshm.admin.fn.pad(l,2,"0");a("<option>").attr("value",p).attr("selected",l==n).text(p).appendTo(d)}d.trigger("change")}),d.children().remove().end().on("change",function(){n=parseInt(a(this).find(":selected").val())}),o)o.hasOwnProperty(c)&&a("<option>").attr("value",c).text(o[c].label).appendTo(r).data("initial_hour",o[c].initial_hour).data("initial_minute",o[c].initial_minute);r.trigger("change"),i.trigger("change")}},pad:function(a,e,t){return t=t||"0",(a+="").length>=e?a:new Array(e-a.length+1).join(t)+a},handleCheckOrderForm:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.createOrderFormClass),function(t){t.preventDefault();var n=[{text:e.wcshm.admin.fn.translate("Cancel"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Submit"),class:"button-primary",click:function(){var t=[{text:e.wcshm.admin.fn.translate("Track Order"),click:function(){var t=e.wcshm.admin.fn.decodeToHtml(a(this).data("response").tracking_url);e.wcshm.admin.fn.openTab(t)}},{text:e.wcshm.admin.fn.translate("View Order"),class:"button-primary",click:function(){var t=e.wcshm.admin.fn.decodeToHtml(a(this).data("response").edit_url);e.wcshm.admin.fn.openTab(t)}}],n=a(this);n.dialog("destroy"),e.wcshm.admin.fn.showModal("submit-order",e.wcshm.admin.fn.translate("Alopeyk Order"),"submit_order_modal",n.data("response"),t,null,function(){var t=a("#"+e.wcshm.admin.fn.addPrefix("modal-create-order"));t.length&&t.dialog("destroy"),a(document).trigger("awcshm:order:create")})}}],o=a(this),s=o.serialize(),r=e.wcshm.admin.fn.getUrlVars("#?"+s);if("false"==r.ship_now&&r.ship_date&&r.ship_date.length&&r.ship_hour&&r.ship_hour.length&&r.ship_minute&&r.ship_minute.length&&e.wcshm.admin.vars.common.time&&e.wcshm.admin.vars.common.info.time){var i=new Date(parseInt((""+e.wcshm.admin.vars.common.info.time).replace(/-/g,"/")))-new Date(parseInt((""+e.wcshm.admin.vars.common.time).replace(/-/g,"/")));if(new Date(r.ship_date+" "+r.ship_hour+":"+r.ship_minute+":00").getTime()+i>Date.now())e.wcshm.admin.fn.showModal("check-order",e.wcshm.admin.fn.translate("Alopeyk Order"),"check_order_modal",s,n);else{var d=[{text:e.wcshm.admin.fn.translate("No"),click:function(){a(this).dialog("destroy")}},{text:e.wcshm.admin.fn.translate("Yes"),class:"button-primary",click:function(){a(e.wcshm.admin.vars.forms.shipNowTogglerElement).val(["true"]),s=o.serialize(),a(this).dialog("destroy"),e.wcshm.admin.fn.showModal("check-order",e.wcshm.admin.fn.translate("Alopeyk Order"),"check_order_modal",s,n)}}];e.wcshm.admin.fn.showModal("check-order-time",e.wcshm.admin.fn.translate("Alopeyk Order"),null,null,d,e.wcshm.admin.vars.common.info.alopeyk.wcshm.scope.schedule_dates.error)}}else e.wcshm.admin.fn.showModal("check-order",e.wcshm.admin.fn.translate("Alopeyk Order"),"check_order_modal",s,n)})},handleAddCouponForm:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.addCouponFormClass),function(t){t.preventDefault();var n=a(this).serialize();e.wcshm.admin.fn.showModal("add-coupon",e.wcshm.admin.fn.translate("Alopeyk Coupon"),"add_coupon_modal",n,null,null,function(){var t=a("#"+e.wcshm.admin.fn.addPrefix("modal-create-coupon")),n=a("#"+e.wcshm.admin.fn.addPrefix("modal-create-credit")),o=a("#"+e.wcshm.admin.fn.addPrefix("modal-check-order"));t.length&&t.dialog("destroy"),n.length&&n.dialog("destroy"),o.length&&o.dialog("destroy"),a(document).trigger("awcshm:credit:add")})})},handleCancelOrderForm:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.cancelOrderFormClass),function(t){t.preventDefault();var n=a(this).serialize();e.wcshm.admin.fn.showModal("cancel-order-result",e.wcshm.admin.fn.translate("Cancel Order"),"cancel_result_modal",n,null,null,function(){var t=a("#"+e.wcshm.admin.fn.addPrefix("modal-cancel-order"));t.length&&t.dialog("destroy"),a(document).trigger("awcshm:order:cancel")})})},handleRateOrderForm:function(){a(document).on("submit","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.rateOrderFormClass),function(t){t.preventDefault();var n=a(this).serialize();e.wcshm.admin.fn.showModal("rate-order-result",e.wcshm.admin.fn.translate("Rate Alopeyk Courier"),"rate_result_modal",n,null,null,function(){var t=a("#"+e.wcshm.admin.fn.addPrefix("modal-rate-order"));t.length&&t.dialog("destroy"),a(document).trigger("awcshm:order:finish")})})},setupCreditModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.creditModalTogglerClass),function(t){t.preventDefault();var n=a(this).data(e.wcshm.admin.vars.modals.creditModalAmountDataAttr);e.wcshm.admin.fn.createCreditModal(n)})},setupOrderModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.orderModalTogglerClass),function(t){t.preventDefault();var n=a(this),o=n.data(e.wcshm.admin.vars.modals.orderModalTypeDataAttr),s=n.data(e.wcshm.admin.vars.modals.orderModalOrdersDataAttr),r=n.data(e.wcshm.admin.vars.modals.orderModalDescriptionDataAttr);s=(s=void 0!==s?s+"":null)&&s.length?s.split(e.wcshm.admin.vars.modals.orderModalOrdersDelimiter):null,e.wcshm.admin.fn.createOrderModal(s,o,r)})},setupCouponModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.couponModalTogglerClass),function(a){a.preventDefault(),e.wcshm.admin.fn.createCouponModal()})},setupCancelModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.cancelModalTogglerClass),function(t){t.preventDefault(),e.wcshm.admin.fn.createCancelModal(a(this).data(e.wcshm.admin.vars.modals.cancelModalOrderDataAttr))})},setupRateModalTrigger:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.modals.rateModalTogglerClass),function(t){t.preventDefault(),e.wcshm.admin.fn.createRateModal(a(this).data(e.wcshm.admin.vars.modals.rateModalOrderDataAttr))})},handleAmountButtons:function(){a(document).on("click","."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.creditButtonElementClass),function(){var t=a(this),n=t.data(e.wcshm.admin.vars.forms.creditButtonAmountDataAttr),o=a(t.data(e.wcshm.admin.vars.forms.creditButtonTargetDataAttr));(o=o&&o.length?o:a("."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.priceInputsClass))).length&&o.val(n||"")})},handlePriceInputs:function(){var t="."+e.wcshm.admin.fn.addPrefix(e.wcshm.admin.vars.forms.priceInputsClass);a(document).on("keydown",t,function(e){-1!==a.inArray(e.keyCode,[46,8,9,27,13,110,190])||/65|67|86|88/.test(e.keyCode)&&(!0===e.ctrlKey||!0===e.metaKey)&&(!0===e.ctrlKey||!0===e.metaKey)||35<=e.keyCode&&40>=e.keyCode||(e.shiftKey||48>e.keyCode||57<e.keyCode)&&(96>e.keyCode||105<e.keyCode)&&e.preventDefault()}),a(document).on("change paste keyup input propertychange",t,function(e){var t=a(this),n=t.val();t.val(n.replace(/\D/g,""))}).trigger("change")},handlePageUpdates:function(){var t=[],n=parseInt(e.wcshm.admin.vars.common.info.refresh_interval),o=e.wcshm.admin.vars.common.info.dynamic_parts;if(o&&o.length&&(a.each(o,function(e,n){a(n).length&&t.push(n)}),t.length)){var s=function(){e.wcshm.admin.vars.common.pageUpdateConnection&&e.wcshm.admin.vars.common.pageUpdateConnection.abort(),e.wcshm.admin.vars.common.pageUpdateConnection=a.ajax(window.location.href).done(function(e){var n=a(e);a.each(t,function(e,t){var o=a(t),s=n.find(t).html();o.html()!=s&&o.html(s)})})};setInterval(s,1e3*(n||10));a(document).on("awcshm:order:create awcshm:order:cancel awcshm:order:finish awcshm:credit:add",s)}},handleChatToggler:function(){a(document).on("change",e.wcshm.admin.vars.chat.togglerInput,function(){if(a(this).prop("checked")){var e=a(document).height()>a(window).height();a("html, body").stop().animate({scrollTop:0},250,function(){a("body").scrollTop(0).css("overflow","hidden").parent().css("overflow-y",e?"scroll":"")})}else a("body").css("overflow","").parent().css("overflow-y","")}),a(e.wcshm.admin.vars.chat.togglerInput).trigger("change")},init:function(){e.wcshm.admin.fn.handlePageUpdates(),e.wcshm.admin.fn.handleChatToggler(),e.wcshm.admin.fn.handlePriceInputs(),e.wcshm.admin.fn.handleAmountButtons(),e.wcshm.admin.fn.handleSettingFields(),e.wcshm.admin.fn.handleBulkAction(),e.wcshm.admin.fn.handleDateTimeFilters(),e.wcshm.admin.fn.handleCheckOrderForm(),e.wcshm.admin.fn.handleCancelOrderForm(),e.wcshm.admin.fn.handleRateOrderForm(),e.wcshm.admin.fn.handleAddCouponForm(),e.wcshm.admin.fn.setupCreditModalTrigger(),e.wcshm.admin.fn.setupOrderModalTrigger(),e.wcshm.admin.fn.setupCancelModalTrigger(),e.wcshm.admin.fn.setupCouponModalTrigger(),e.wcshm.admin.fn.setupRateModalTrigger(),e.wcshm.admin.fn.handleBelowHeadingElements()}},a(document).on({ready:function(a){e.wcshm.admin.fn.init()}}),a(window).on({load:function(a){e.wcshm.admin.fn.initMaps()}})}(jQuery);